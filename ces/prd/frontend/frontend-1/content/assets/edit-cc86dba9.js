import{g as j,f as D,i as U,r as o,j as V,v as g,k,N as H,L as Y,u as s,B as f,w as B,l as E,c as $,e as q,q as p,n as z,s as a,J as T,F as J}from"./index-80ba5b4e.js";import{o as v}from"./organization-3bd78b8a.js";import{u as Q}from"./organization-3f9f41dc.js";import{o as F}from"./helpers-80252163.js";import{b as W}from"./helpers-4a70dd55.js";import{u as X}from"./index.esm-5a51e55a.js";import{e as Z}from"./edit-actions-2d7f214b.js";import{_ as x}from"./form-f6d99000.js";import{_ as ee}from"./unsaved-29fba484.js";import"./index.esm-ae8bce41.js";import"./refusal-a24432e0.js";import"./cancel-confirm-9074d80e.js";import"./settings-ad5b6b99.js";/* empty css                                                                     */import"./contacts-463a38f5.js";import"./location-e6995fd0.js";import"./address-3425eb55.js";import"./generic-19299c69.js";import"./point-of-care-bba055b1.js";import"./helpers-dace0e20.js";import"./service-dba6f9b8.js";import"./helpers-680aec35.js";import"./helpers-330ffe65.js";import"./document-1a2365b5.js";import"./helpers-7f969476.js";const Le={__name:"edit",setup(ae){const P=j(),d=D();U();const u=Q();let c=o(0),m=o(0),r=o(!0),e=V(F.newForm()),n=o(g.language.pt),y=V(F.formRules()),O=o(0),I=o([]),C=o(!1),b=o(0),S=o(0);const L=X(y,e,{$stopPropagation:!0}),h=k(()=>O.value===100&&!r.value),w=o(H.havePermission(g.permissions.organization.createEdit));Y(async()=>{c.value=s.decodeId(d.params.organizationId),m.value=s.decodeId(d.params.organizationVersion),C.value=d.params.organicOrigin==="true",b.value=s.decodeId(d.params.parentOrganizationId),S.value=s.decodeId(d.params.parentOrganizationVersion),!c.value||!m.value?P.push({name:f.router.BACKOFFICE_ENTITIES_PAGE.name}):(await R(),await A(),await M())});async function R(){r.value=!0;const t=await v.getById(c.value,m.value);s.validateResponse(t,null,()=>{Object.assign(e,t.data),u.setFormToCompare(s.cloneObject(t.data))}),r.value=!1}async function A(){r.value=!0;const t=await v.getLists(n.value,e.recordStateTypeId!=g.recordStateType.draft);s.validateResponse(t,null,()=>{u.setLists(t.data)}),r.value=!1}async function M(){r.value=!0;const t=await v.getLists(n.value,!0);s.validateResponse(t,null,()=>{u.setOrganizationOnlypublishedList(t.data)}),r.value=!1}B(()=>n.value,()=>{A()}),B(()=>[e.nipc,e.texts[0].name,e.groupName,e.organizationTypeId,e.parentOrganization,e.startDate,e.economicActivityId,e.divisionTypeId,e.divisionId,e.address.zipCode,e.address.islandId,e.address.countyId,e.address.parishId,e.address.locality,e.address.address],()=>{I.value=F.progressFields(),e.divisionTypeId===g.notApplicable&&s.removeItemOfArray(I.value,"divisionId"),W.calculatePercentage(e,I.value,t=>{u.setProgress(t),O.value=t})});const N=k(()=>{if(b.value>0){const t=u.organizationList.find(_=>_.value3.id===b.value);let i=f.router.BACKOFFICE_EDIT_ENTITY_PAGE.path;return(t==null?void 0:t.state)!=g.recordStateType.draft&&(i=f.router.BACKOFFICE_DETAIL_ENTITY_PAGE.path),`${i.replace(":organizationId",d.params.parentOrganizationId).replace(":organizationVersion",d.params.parentOrganizationVersion)}#pontosatendimento`}else return f.router.BACKOFFICE_ENTITIES_PAGE.name});return(t,i)=>{const _=E("breadcrumb-item"),G=E("breadcrumb"),K=E("page");return $(),q(J,null,[p(K,{title:t._lang.backoffice.entities.editPageTitle},{breadcrumb:z(()=>[p(G,{"has-home":!0},{default:z(()=>[p(_,{label:t._lang.backoffice.entities.breadcrumbTitle,"router-path":a(f).router.BACKOFFICE_ENTITIES_PAGE.path},null,8,["label","router-path"]),p(_,{label:t._lang.backoffice.entities.editPageTitle},null,8,["label"])]),_:1})]),actions:z(()=>[p(Z,{loading:a(r),"onUpdate:loading":i[0]||(i[0]=l=>T(r)?r.value=l:r=l),canSubmit:a(h),selectedLang:a(n),"onUpdate:selectedLang":i[1]||(i[1]=l=>T(n)?n.value=l:n=l),backRoute:a(N),service:a(v),itemId:a(c),itemVersion:a(m),formModel:a(e),vuelidate:a(L),store:a(u),directBackRoute:a(b)>0,resource:t._lang.backoffice.entities,itemIdField:"organizationId",progressFields:a(I),organicOrigin:a(C)},null,8,["loading","canSubmit","selectedLang","backRoute","service","itemId","itemVersion","formModel","vuelidate","store","directBackRoute","resource","progressFields","organicOrigin"])]),default:z(()=>[p(x,{formModel:a(e),"onUpdate:formModel":i[2]||(i[2]=l=>T(e)?e.value=l:e=l),disabled:!1,validateForm:!0,selectedLang:a(n),rules:a(y),loading:a(r),organizationId:a(c),organizationVersion:a(m),progressValue:a(O),"show-progress":!0,vuelidate:a(L),canCreate:w.value},null,8,["formModel","selectedLang","rules","loading","organizationId","organizationVersion","progressValue","vuelidate","canCreate"])]),_:1},8,["title"]),p(ee,{store:a(u),formModel:a(e),service:a(v),resource:t._lang.backoffice.entities},null,8,["store","formModel","service","resource"])],64)}}};export{Le as default};
