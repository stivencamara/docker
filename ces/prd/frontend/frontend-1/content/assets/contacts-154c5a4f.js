import{i as W,h as J,H as M,r as g,j,k as d,c as $,l as q,m as r,p as t,q as e,t as c,u as h,R as E,L as ne,w as D,W as se,J as K,N as H,e as de,S as ie,U as ce,z as re,V as ue,X as me,F as pe}from"./index-af43a57b.js";import{u as fe}from"./index.esm-26e5e98d.js";import{b as P}from"./helpers-0b287b89.js";import{l as A}from"./location-5ea34e4e.js";import{_ as be}from"./address-7a25e4a7.js";import{u as ye}from"./organization-25c5b553.js";const ke={__name:"create",props:{modelValue:{type:Array,required:!0},store:{type:Object,required:!0}},emits:["update:modelValue"],setup(F,{emit:L}){const s=F,w=W();J();const u="create-contact";let n=M(_()),y=g(!1),b=P.contactsFormRules();const l=fe(b,n,{$scope:!1}),I=j({get(){return s.modelValue},set(o){L("update:modelValue",o)}});function _(){return{contactValue:null,contactScopeId:null,contactTypeId:null}}function C(){n=Object.assign(n,_()),l.value.$reset()}async function T(){if(y.value=!0,await l.value.$validate(),!l.value.$error){const o={contactValue:n.contactValue,contactScopeId:n.contactScopeId,contactScopeName:P.getLabel(s.store.contactScopeList,n.contactScopeId),contactTypeId:n.contactTypeId,contactTypeName:P.getLabel(s.store.contactTypeList,n.contactTypeId)};I.value.filter(f=>f.contactValue===n.contactValue&&f.contactScopeId===n.contactScopeId&&f.contactTypeId===n.contactTypeId).length?E.warning(w.common.contactExists):(I.value.push(o),n=Object.assign(n,_()),l.value.$reset(),h.closeModalById(u),E.success(w.common.contactAdded))}y.value=!1}return(o,p)=>{const f=d("form-field"),S=d("row"),z=d("cbutton"),v=d("modal");return $(),q(v,{id:u,title:o._lang.common.addContact,size:e(c).modalSize.extraLarge},{body:r(()=>[t(S,null,{default:r(()=>[t(f,{id:"contactScopeId",class:"mb-3 col-12 col-md-6",modelValue:e(n).contactScopeId,"onUpdate:modelValue":p[0]||(p[0]=V=>e(n).contactScopeId=V),label:o._lang.label.contactScopeId,disabled:s.disabled,loading:s.loading,type:e(c).inputs.multiselect,required:!0,"show-error":e(l).contactScopeId.$error,"error-message":o._errorMessageField(e(l).contactScopeId),options:s.store.contactScopeList},null,8,["modelValue","label","disabled","loading","type","show-error","error-message","options"]),t(f,{id:"contactTypeId",class:"mb-3 col-12 col-md-6",modelValue:e(n).contactTypeId,"onUpdate:modelValue":p[1]||(p[1]=V=>e(n).contactTypeId=V),label:o._lang.label.contactTypeId,disabled:s.disabled,loading:s.loading,type:e(c).inputs.multiselect,required:!0,"show-error":e(l).contactTypeId.$error,"error-message":o._errorMessageField(e(l).contactTypeId),options:s.store.contactTypeList},null,8,["modelValue","label","disabled","loading","type","show-error","error-message","options"])]),_:1}),t(S,null,{default:r(()=>[t(f,{id:"contactValue",class:"mb-3 col-12",modelValue:e(n).contactValue,"onUpdate:modelValue":p[2]||(p[2]=V=>e(n).contactValue=V),label:o._lang.label.contactValue,disabled:s.disabled,loading:s.loading,type:e(c).inputs.textarea,maxlength:255,required:!0,"show-error":e(l).contactValue.$error,"error-message":o._errorMessageField(e(l).contactValue)},null,8,["modelValue","label","disabled","loading","type","show-error","error-message"])]),_:1})]),footer:r(()=>[t(z,{title:o._lang.common.cancel,type:e(c).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:e(y),onClick:C},null,8,["title","type","disabled"]),t(z,{title:o._lang.common.save,onClick:T,disabled:e(y)},null,8,["title","disabled"])]),_:1},8,["title","size"])}}},he={__name:"search-location",emits:["apply"],setup(F,{emit:L}){const s=ye(),w="search-location";let u=g(!1),n=g(0),y=M(h.createEmptyDataSource()),b=M(Q()),l=M(f()),I=g([]),_=g([]),C=g([]),T=g(!1);ne(async()=>{await v(),await X()});async function o(a){l.sortBy=a,await v()}async function p(a){l.pageIndex=a,await v()}function f(){return{pageIndex:1,sortBy:"Code desc",code:null,locationTypeId:null,abreviation:null,location:null,recordStateIds:[c.recordStateType.submitted,c.recordStateType.approval,c.recordStateType.published],parentOrganizationId:null,islandId:null,countyId:null,parishId:null,zipCode:null,lat:null}}async function S(){Object.assign(l,f()),v()}async function z(){await v()}async function v(){u.value=!0;let a=await A.search(l);h.validateResponse(a,null,()=>{y=a.data}),u.value=!1}async function V(a){const i=await A.getById(a.locationId,a.locationVersion);h.validateResponse(i,null,()=>{Object.assign(b,i.data),T.value=!0}),n.value++}function O(){}function N(){L("apply",b)}function Q(){return{address:null,locationId:null,zipCode:null,islandId:null,countyId:null,parishId:null,location:null,latitude:null,longitude:null,code:null}}async function X(){u.value=!0;const a=await A.getLists("pt");h.validateResponse(a,null,()=>{I.value=a.data.divisionList}),u.value=!1}function G(a){return I.value.find(k=>k.value===a).children}function Y(a){return I.value.find(B=>B.value===l.islandId).children.find(B=>B.value===a).children}D(()=>l.islandId,()=>{const a=l.islandId;l.countyId=null,l.parishId=null,l.islandId||(l.countyId=null,l.parishId=null),a?_.value=G(a):(_.value=[],C.value=[])}),D(()=>l.countyId,()=>{const a=l.countyId;l.parishId=null,l.countyId||(l.parishId=null),a?C.value=Y(a):C.value=[]});const Z=j(()=>!l.islandId),x=j(()=>!l.countyId);return(a,i)=>{const k=d("form-field"),B=d("row"),ee=d("cfilter"),U=d("ccolumn"),le=d("table-action-detail"),ae=d("ctable"),te=d("accordion"),R=d("cbutton"),oe=d("modal");return $(),q(oe,{id:w,title:a._lang.backoffice.location.searchTitle,size:e(c).modalSize.extraLarge,"remove-padding":!0},{body:r(()=>[t(ee,{title:a._lang.common.filter,"clear-click":S,"apply-click":z,loading:e(u),collapsed:!1},{default:r(()=>[t(B,null,{default:r(()=>[t(k,{id:"code-filter",class:"mb-3 col-12 col-md-6",label:a._lang.label.code,type:e(c).inputs.text,maxlength:45,modelValue:e(l).code,"onUpdate:modelValue":i[0]||(i[0]=m=>e(l).code=m)},null,8,["label","type","modelValue"]),t(k,{id:"islandId-filter",class:"mb-3 col-12 col-md-6",modelValue:e(l).islandId,"onUpdate:modelValue":i[1]||(i[1]=m=>e(l).islandId=m),label:a._lang.label.islandId,loading:e(u),type:e(c).inputs.multiselect,options:e(I)},null,8,["modelValue","label","loading","type","options"]),t(k,{id:"countyId-filter",class:"mb-3 col-12 col-md-6 col-lg-4",modelValue:e(l).countyId,"onUpdate:modelValue":i[2]||(i[2]=m=>e(l).countyId=m),label:a._lang.label.countyId,loading:e(u),type:e(c).inputs.multiselect,options:e(_),disabled:e(Z)},null,8,["modelValue","label","loading","type","options","disabled"]),t(k,{id:"parishId-filter",class:"mb-3 col-12 col-md-6 col-lg-4",modelValue:e(l).parishId,"onUpdate:modelValue":i[3]||(i[3]=m=>e(l).parishId=m),label:a._lang.label.parishId,loading:e(u),type:e(c).inputs.multiselect,options:e(C),disabled:e(x)},null,8,["modelValue","label","loading","type","options","disabled"]),t(k,{id:"zipCode-filter",class:"mb-3 col-md-12 col-lg-4",label:a._lang.label.zipCode,type:e(c).inputs.zipCode,maxlength:45,modelValue:e(l).zipCode,"onUpdate:modelValue":i[4]||(i[4]=m=>e(l).zipCode=m)},null,8,["label","type","modelValue"])]),_:1})]),_:1},8,["title","loading"]),t(se,null,{default:r(()=>[t(ae,{onSort:o,onChangePage:p,data:e(y),loading:e(u),checkbox:!1},{columns:r(()=>[t(U,{name:"CÃ³digo",field:"code",sortable:!0}),t(U,{name:a._lang.label.islandId,field:"island",sortField:"islandId",sortable:!0},null,8,["name"]),t(U,{name:a._lang.label.countyId,field:"county",sortField:"countyId",sortable:!0},null,8,["name"]),t(U,{name:a._lang.label.parishId,field:"parish",sortField:"parishId",sortable:!0},null,8,["name"]),t(U,{name:a._lang.label.zipCode,field:"zipCode",sortField:"zipCode",sortable:!0},null,8,["name"])]),actions:r(m=>[t(le,{onClick:ge=>V(m.item)},null,8,["onClick"])]),_:1},8,["data","loading"])]),_:1}),($(),q(te,{id:"address",title:a._lang.backoffice.entities.address,collapsed:e(T),class:"mt-4",key:e(n)},{default:r(()=>[t(be,{modelValue:e(b),"onUpdate:modelValue":i[5]||(i[5]=m=>K(b)?b.value=m:b=m),disabled:!0,validateForm:!1,showMap:!1,store:e(s),vuelidate:null},null,8,["modelValue","store"])]),_:1},8,["title","collapsed"]))]),footer:r(()=>[t(R,{type:"primary",size:"large",title:a._lang.common.apply,"data-bs-dismiss":"modal",onClick:N,disabled:!e(b).code},null,8,["title","disabled"]),t(R,{type:"secondary",size:"large",title:a._lang.common.cancel,"data-bs-dismiss":"modal",onClick:O},null,8,["title"])]),_:1},8,["title","size"])}}},we={__name:"contacts",props:{modelValue:{type:Array,required:!0},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},rules:{type:Object,default:{}},validateForm:{type:Boolean,default:!1},modal:{type:Object,required:!0},store:{type:Object,required:!0},canCreate:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(F,{emit:L}){const s=F,w="delete-contact";J();const u=W(),n=j({get(){return s.modelValue},set(o){L("update:modelValue",o)}}),y=j(()=>h.createEmptyDataSource(n.value));let b=g(!1),l=g(null);const I=g(H.havePermission(c.permissions.service.createEdit||H.havePermission(c.permissions.organization.createEdit)));function _(o){l.value=o}function C(){l.value&&(h.removeItemOfArray(n.value,l.value),E.success(u.common.contactRemoved),l.value=null)}function T(o){h.sortArrayOffline(o,y.value.items)}return(o,p)=>{const f=d("table-actions"),S=d("ccolumn"),z=d("table-action-delete"),v=d("ctable"),V=d("confirm-delete-modal");return $(),de(pe,null,[t(ue,{id:"contacts",title:o._lang.common.contacts,collapsed:!1,class:"mb-4"},{default:r(()=>[I.value?($(),q(f,{key:0},{default:r(()=>[t(ie,{target:"create-contact",class:"d-inline",type:e(c).buttonType.secondary,title:o._lang.common.toAdd,disabled:s.disabled,icon:ce},null,8,["type","title","disabled"])]),_:1})):re("",!0),t(v,{data:e(y),loading:e(b),checkbox:!1,onSort:T,showPagination:!1},{columns:r(()=>[t(S,{name:o._lang.label.contactScopeId,field:"contactScopeName",fieldSort:"contactScopeId",sortable:!0},null,8,["name"]),t(S,{name:o._lang.label.contactTypeId,field:"contactTypeName",fieldSort:"contactTypeId",sortable:!0},null,8,["name"]),t(S,{name:o._lang.label.contactValue,field:"contactValue",sortable:!0},null,8,["name"])]),actions:r(O=>[t(z,{id:w,onClick:N=>_(O.item),disabled:s.disabled},null,8,["onClick","disabled"])]),_:1},8,["data","loading"])]),_:1},8,["title"]),($(),q(me(s.modal),{modelValue:e(n),"onUpdate:modelValue":p[0]||(p[0]=O=>K(n)?n.value=O:null),store:F.store},null,8,["modelValue","store"])),t(V,{id:w,title:o._lang.common.deleteContact,message:o._lang.common.deleteContactQuestion,action:C},null,8,["title","message"])],64)}}};export{he as _,ke as a,we as b};
