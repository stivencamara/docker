import{_ as H}from"./general-518baca8.js";import{g as Y,f as q,i as J,r as s,H as V,t as T,j as w,w as O,L as $,u as m,A as p,k as f,c as k,e as C,p as o,m as g,q as e,F as A,J as y}from"./index-af43a57b.js";import{d as I}from"./document-da522e3d.js";import{d as h}from"./helpers-e1085a17.js";import{u as Q}from"./document-cf8abce2.js";import{u as W}from"./index.esm-26e5e98d.js";import{b as X}from"./helpers-0b287b89.js";import{e as Z}from"./edit-actions-e0b46285.js";import{_ as x}from"./unsaved-df2d10f6.js";import"./refusal-a7068635.js";import"./index.esm-7a0fc0c5.js";import"./generic-b7841e8a.js";import"./cancel-confirm-3c568d61.js";import"./settings-da6dde1b.js";/* empty css                                                                     */const be={__name:"edit",setup(ee){const R=Y(),b=q(),S=J(),d=Q();let r=s(!0),t=V(h.newForm()),u=s(T.language.pt);s([]);let B=V(h.formRules()),_=s(0),E=s(0),c=s(0),v=s(0),F=s([]);const M=W(B,t),z=w(()=>E.value===100&&!r.value);async function D(){r.value=!0;let a=await I.getById(_.value,v.value);m.validateResponse(a,null,async()=>{Object.assign(t,a.data),d.setFormToCompare(m.cloneObject(a.data))}),r.value=!1}async function L(){r.value=!0;const a=await I.getLists(u.value,t.recordStateTypeId!=T.recordStateType.draft);m.validateResponse(a,null,()=>{d.setLists(a.data)}),r.value=!1}O(()=>u.value,()=>{L()}),$(async()=>{_.value=m.decodeId(b.params.documentId),v.value=m.decodeId(b.params.documentVersion),c.value=m.decodeId(b.params.organizationId),!_.value||!v.value?R.push({name:p.router.BACKOFFICE_DOCUMENT_PAGE.name}):(await D(),await L())}),O(()=>[t.texts[0].name,t.organization,t.documentTypeId,t.startDate,t.document],()=>{F.value=h.progressFields(),X.calculatePercentage(t,F.value,a=>{d.setProgress(a),E.value=a})});const P=w(()=>{if(c.value>0){const a=d.organizationList.find(i=>i.value3.id===c.value);let l=p.router.BACKOFFICE_EDIT_ENTITY_PAGE.path;return(a==null?void 0:a.state)!=T.recordStateType.draft&&(l=p.router.BACKOFFICE_DETAIL_ENTITY_PAGE.path),`${l.replace(":organizationId",b.params.organizationId).replace(":organizationVersion",b.params.organizationVersion)}#documentos`}else return p.router.BACKOFFICE_DOCUMENT_PAGE.name});return(a,l)=>{const i=f("breadcrumb-item"),N=f("breadcrumb"),G=f("progress-bar"),K=f("container-wrapper"),U=f("card"),j=f("page");return k(),C(A,null,[o(j,{title:a._lang.backoffice.document.editPageTitle},{breadcrumb:g(()=>[o(N,{"has-home":!0},{default:g(()=>[e(c)>0?(k(),C(A,{key:0},[o(i,{label:a._lang.backoffice.entities.breadcrumbTitle,"router-path":e(p).router.BACKOFFICE_ENTITIES_PAGE.path},null,8,["label","router-path"]),o(i,{label:e(S).common.entity,"router-path":e(P)},null,8,["label","router-path"]),o(i,{label:a._lang.backoffice.document.editPageTitle},null,8,["label"])],64)):(k(),C(A,{key:1},[o(i,{label:a._lang.backoffice.document.breadcrumbTitle,"router-path":e(p).router.BACKOFFICE_DOCUMENT_PAGE.path},null,8,["label","router-path"]),o(i,{label:a._lang.backoffice.document.editPageTitle},null,8,["label"])],64))]),_:1})]),actions:g(()=>[o(Z,{loading:e(r),"onUpdate:loading":l[0]||(l[0]=n=>y(r)?r.value=n:r=n),canSubmit:e(z),selectedLang:e(u),"onUpdate:selectedLang":l[1]||(l[1]=n=>y(u)?u.value=n:u=n),backRoute:e(P),directBackRoute:e(c)>0,service:e(I),itemId:e(_),itemVersion:e(v),formModel:e(t),vuelidate:e(M),store:e(d),resource:a._lang.backoffice.document,itemIdField:"documentId",progressFields:e(F)},null,8,["loading","canSubmit","selectedLang","backRoute","directBackRoute","service","itemId","itemVersion","formModel","vuelidate","store","resource","progressFields"])]),default:g(()=>[o(U,{shadow:!0},{body:g(()=>[o(K,{"margin-top":!1},{default:g(()=>[o(G,{value:e(E),label:a._lang.common.fill,class:"mb-4 col-12 float-end"},null,8,["value","label"])]),_:1}),o(H,{modelValue:e(t),"onUpdate:modelValue":l[2]||(l[2]=n=>y(t)?t.value=n:t=n),disabled:!1,loading:e(r),selectedLang:e(u),validateForm:!0,rules:e(B),isExternalEdit:e(c)>0},null,8,["modelValue","loading","selectedLang","rules","isExternalEdit"])]),_:1})]),_:1},8,["title"]),o(x,{formModel:e(t),store:e(d),service:e(I),resource:a._lang.backoffice.document},null,8,["formModel","store","service","resource"])],64)}}};export{be as default};
