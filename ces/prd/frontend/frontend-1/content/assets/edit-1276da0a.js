import{_ as H}from"./form-717e4e4a.js";import{g as U,f as x,i as Y,r as s,H as R,t as m,j as w,w as z,L as q,u,A as g,k as F,c as k,e as C,p as i,m as _,q as r,F as V,J as A}from"./index-af43a57b.js";import{s as T}from"./service-9ee13c2f.js";import{s as b}from"./helpers-74c6ab4d.js";import{u as J}from"./service-adeb7206.js";import{u as $}from"./index.esm-26e5e98d.js";import{b as Q}from"./helpers-0b287b89.js";import{e as W}from"./edit-actions-e0b46285.js";import{_ as X}from"./unsaved-df2d10f6.js";import"./index.esm-7a0fc0c5.js";import"./address.vue_vue_type_style_index_0_scoped_5480b292_lang-5c9173d9.js";import"./point-of-care-3902aa6d.js";import"./form-255940d6.js";import"./settings-da6dde1b.js";import"./legislation-6b9a93ce.js";import"./organization-25c5b553.js";import"./helpers-8beca418.js";import"./refusal-a7068635.js";import"./generic-b7841e8a.js";import"./point-of-care-9754b2ef.js";import"./helpers-bf231dc4.js";import"./cancel-confirm-3c568d61.js";/* empty css                                                                     */const ye={__name:"edit",setup(Z){const M=U(),p=x(),G=Y(),v=J();let l=s(!0),e=R(b.newForm()),c=s(m.language.pt);s([]);let h=R(b.formRules()),I=s(0),S=s(0),y=s(0),f=s(0),B=s(!1),K=s(0),d=s([]);const O=$(h,e),N=w(()=>y.value===100&&!l.value);async function j(){l.value=!0;const a=await T.getById(I.value,S.value);u.validateResponse(a,null,()=>{let t=a.data;t.eventTypeId=t.lifeEventId?m.eventType.life:m.eventType.business,t.processingTime.type=t.processingTime.weeks?m.processingTimeType.simplified:m.processingTimeType.advanced,t.virtual=t.virtual==null?b.newVirtual():t.virtual,t.stateSupport=t.stateSupport==null?b.newStateSupport():t.stateSupport,Object.assign(e,t),v.setFormToCompare(u.cloneObject(t))}),l.value=!1}async function L(){l.value=!0;const a=await T.getLists(c.value,e.recordStateTypeId!=m.recordStateType.draft);u.validateResponse(a,null,()=>{v.setLists(a.data)}),l.value=!1}z(()=>c.value,()=>{L()}),q(async()=>{I.value=u.decodeId(p.params.serviceId),S.value=u.decodeId(p.params.serviceVersion),f.value=u.decodeId(p.params.organizationId),K.value=u.decodeId(p.params.organizationVersion),B.value=p.params.organicOrigin==="true",!I.value||!S.value?M.push({name:g.router.BACKOFFICE_SERVICE_PAGE.name}):(await j(),await L())}),z(()=>{var a,t,o,E;return[e.texts[0].name,e.organization,e.serviceTypeId,e.serviceCategoryId,e.startDate,e.economicActivityId,(a=e.virtual)==null?void 0:a.isVirtual,(t=e.virtual)==null?void 0:t.url,(o=e.stateSupport)==null?void 0:o.isStateSupport,(E=e.stateSupport)==null?void 0:E.url]},()=>{var a,t;d.value=b.progressFields(),(a=e.virtual)!=null&&a.isVirtual?d.value.push("virtual.url"):(u.removeItemOfArray(d.value,"virtual.url"),e.virtual!=null&&(e.virtual.url=null,e.virtual.externalSystemId=null,e.virtual.processId=null,e.virtual.canExecutedByThirdParty=null)),(t=e.stateSupport)!=null&&t.isStateSupport?d.value.push("stateSupport.url"):(u.removeItemOfArray(d.value,"stateSupport.url"),e.stateSupport!=null&&(e.stateSupport.url=null,e.stateSupport.externalSystemId=null,e.stateSupport.processId=null)),Q.calculatePercentage(e,d.value,o=>{v.setProgress(o),y.value=o})});const P=w(()=>{if(f.value>0){const a=v.organizationList.find(o=>o.value3.id===f.value);let t=g.router.BACKOFFICE_EDIT_ENTITY_PAGE.path;return(a==null?void 0:a.state)!=m.recordStateType.draft&&(t=g.router.BACKOFFICE_DETAIL_ENTITY_PAGE.path),`${t.replace(":organizationId",p.params.organizationId).replace(":organizationVersion",p.params.organizationVersion)}#servicos`}else return g.router.BACKOFFICE_SERVICE_PAGE.name});return(a,t)=>{const o=F("breadcrumb-item"),E=F("breadcrumb"),D=F("page");return k(),C(V,null,[i(D,{title:a._lang.backoffice.service.editPageTitle},{breadcrumb:_(()=>[i(E,{"has-home":!0},{default:_(()=>[r(f)>0?(k(),C(V,{key:0},[i(o,{label:a._lang.backoffice.entities.breadcrumbTitle,"router-path":r(g).router.BACKOFFICE_ENTITIES_PAGE.path},null,8,["label","router-path"]),i(o,{label:r(G).common.entity,"router-path":r(P)},null,8,["label","router-path"]),i(o,{label:a._lang.backoffice.service.editPageTitle},null,8,["label"])],64)):(k(),C(V,{key:1},[i(o,{label:a._lang.backoffice.service.breadcrumbTitle,"router-path":r(g).router.BACKOFFICE_SERVICE_PAGE.path},null,8,["label","router-path"]),i(o,{label:a._lang.backoffice.service.editPageTitle},null,8,["label"])],64))]),_:1})]),actions:_(()=>[i(W,{loading:r(l),"onUpdate:loading":t[0]||(t[0]=n=>A(l)?l.value=n:l=n),canSubmit:r(N),selectedLang:r(c),"onUpdate:selectedLang":t[1]||(t[1]=n=>A(c)?c.value=n:c=n),backRoute:r(P),directBackRoute:r(f)>0,service:r(T),itemId:r(I),itemVersion:r(S),itemIdField:"serviceId",formModel:r(e),vuelidate:r(O),store:r(v),resource:a._lang.backoffice.service,progressFields:r(d),organicOrigin:r(B)},null,8,["loading","canSubmit","selectedLang","backRoute","directBackRoute","service","itemId","itemVersion","formModel","vuelidate","store","resource","progressFields","organicOrigin"])]),default:_(()=>[i(H,{formModel:r(e),"onUpdate:formModel":t[2]||(t[2]=n=>A(e)?e.value=n:e=n),disabled:!1,loading:r(l),selectedLang:r(c),validateForm:!0,rules:r(h),isExternalEdit:r(f)>0,progressValue:r(y),vuelidate:r(O)},null,8,["formModel","loading","selectedLang","rules","isExternalEdit","progressValue","vuelidate"])]),_:1},8,["title"]),i(X,{store:r(v),service:r(T),resource:a._lang.backoffice.service,formModel:r(e)},null,8,["store","service","resource","formModel"])],64)}}};export{ye as default};
