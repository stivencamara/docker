import{_ as G}from"./general-8c9259bc.js";import{h as U,C as H,q as j,D as q,i as n,s as w,v as I,E as h,N as z,K as Y,j as g,l as r,M as x,r as d,o as b,c as C,w as m,a as c,m as e,z as V,y as J}from"./index-d8a56bcc.js";import{d as L}from"./helpers-71f72544.js";import{u as Q}from"./document-a196a5d4.js";import{d as p}from"./document-3c516f4f.js";import"./helpers-d89764d1.js";import{_ as W}from"./detail-actions-61125ebe.js";import"./index.esm-90cb40dd.js";import"./refusal-a1b91175.js";import"./index.esm-d77c3574.js";import"./generic-0bf4d68e.js";import"./helpers-a03e04a5.js";import"./helpers-1cb82c85.js";import"./helpers-eb16543c.js";import"./helpers-84e67dcb.js";import"./helpers-3cc5802d.js";import"./settings-55cfd82c.js";const fe={__name:"detail",setup(X){const y=U(),_=H();j();const k=q(),F=Q();let s=n(!0),a=w(L.newForm()),o=n(I.language.pt),B=w(L.formRules()),i=n(0),l=n(0),f=n(null);const O=h(()=>_.path.toLowerCase().indexOf("tarefas")>-1),T=h(()=>_.path.toLowerCase().indexOf("pesquisa")>-1);async function D(){s.value=!0;const t=await p.getById(i.value,l.value);g.validateResponse(t,null,()=>{Object.assign(a,t.data),k.emit(r.emitter.OBJECT_LOADED,t.data)}),s.value=!1}async function A(){s.value=!0;const t=await p.getLists(o.value,l.value);g.validateResponse(t,null,()=>{F.setLists(t.data)}),s.value=!1}z(()=>o.value,()=>{A()}),Y(async()=>{i.value=g.decodeId(_.params.documentId),l.value=g.decodeId(_.params.documentVersion),!i.value||!l.value?y.push({name:r.router.BACKOFFICE_DOCUMENT_PAGE.name}):(await A(),await D(),R.value&&(await f.value.getHistory(),f.value.setActiveVersion(p.value),f.value.setStep()))});const N=n(x.havePermission(I.permissions.organization.createEdit)),R=h(()=>!O.value&&N.value&&a.recordStateTypeId!=I.recordStateType.draft);return(t,v)=>{const E=d("breadcrumb-item"),M=d("breadcrumb"),P=d("ctimeline"),S=d("card"),K=d("page");return b(),C(K,{title:t._lang.backoffice.document.detailPageTitle},{breadcrumb:m(()=>[c(M,{"has-home":!e(T)},{default:m(()=>[e(T)?(b(),C(E,{key:0,label:t._lang.search.pageTitle,"router-path":e(r).router.BACKOFFICE_SEARCH_HISTORY_PAGE.path},null,8,["label","router-path"])):(b(),C(E,{key:1,label:t._lang.backoffice.document.breadcrumbTitle,"router-path":e(r).router.BACKOFFICE_DOCUMENT_PAGE.path},null,8,["label","router-path"])),c(E,{label:t._lang.backoffice.document.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:m(()=>[c(W,{loading:e(s),selectedLang:e(o),"onUpdate:selectedLang":v[0]||(v[0]=u=>V(o)?o.value=u:o=u),service:e(p),backRoute:e(r).router.BACKOFFICE_DOCUMENT_PAGE.name,editRoute:e(r).router.BACKOFFICE_EDIT_DOCUMENT_PAGE.name,itemIdField:"documentId",itemVersionField:"documentVersion",itemId:e(i),itemVersion:e(l),formModel:e(a),"show-record-state-actions":e(O),store:e(F)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:m(()=>[e(R)?(b(),C(P,{key:0,itemId:e(i),detailRoute:e(r).router.BACKOFFICE_DETAIL_ENTITY_PAGE.name,service:e(p),versionFieldName:"documentVersion",dateFieldName:"documentApprovedDate",detailRouteIdField:"documentId",detailRouteVersionField:"documentVersion",ref_key:"timeline",ref:f},null,8,["itemId","detailRoute","service"])):J("",!0),c(S,{shadow:!0},{body:m(()=>[c(G,{modelValue:e(a),"onUpdate:modelValue":v[1]||(v[1]=u=>V(a)?a.value=u:a=u),disabled:!0,loading:e(s),selectedLang:e(o),validateForm:!0,rules:e(B)},null,8,["modelValue","loading","selectedLang","rules"])]),_:1})]),_:1},8,["title"])}}};export{fe as default};
