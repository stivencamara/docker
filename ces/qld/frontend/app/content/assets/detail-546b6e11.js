import{_ as j}from"./form-a257b9dc.js";import{h as U,C as q,q as x,D as z,i as r,s as S,v as m,E as h,M as J,N as Y,K as Q,j as d,l as o,r as E,o as p,c as v,w as b,a as I,m as e,z as R,y as W}from"./index-60da5de7.js";import{s as C}from"./service-6f3016b9.js";import{s as k}from"./helpers-08b5b49a.js";import{u as X}from"./service-3f94c874.js";import"./helpers-870863ae.js";/* empty css                                                                     */import{_ as Z}from"./detail-actions-425b6347.js";import"./index.esm-eed786a6.js";import"./address.vue_vue_type_style_index_0_scoped_2266ba05_lang-d96445ae.js";import"./index.esm-61763a8c.js";import"./point-of-care-dad35a43.js";import"./form-9c8be7b5.js";import"./settings-bac024a5.js";import"./refusal-f8d08513.js";import"./generic-f0c11361.js";import"./point-of-care-a23179e7.js";import"./organization-b007232b.js";import"./helpers-a90cb10f.js";import"./helpers-06820a25.js";import"./helpers-2fddf39f.js";import"./helpers-7879846e.js";import"./helpers-48506bdb.js";const Fe={__name:"detail",setup($){const w=U(),f=q();x();const O=z(),T=X();let s=r(!0),l=S(k.newForm()),n=r(m.language.pt);r([]);let L=r([]),B=S(k.formRules()),u=r(0),c=r(0),P=r(0),K=r(-1),g=r(null);const F=h(()=>f.path.toLowerCase().indexOf("tarefas")>-1),y=h(()=>f.path.toLowerCase().indexOf("pesquisa")>-1),M=r(J.havePermission(m.permissions.service.createEdit));async function G(){s.value=!0;const a=await C.getById(u.value,c.value);d.validateResponse(a,null,()=>{let t=a.data;t.eventTypeId=t.lifeEventId?m.eventType.life:m.eventType.business,t.processingTime.type=t.processingTime.weeks?m.processingTimeType.simplified:m.processingTimeType.advanced,Object.assign(l,t),O.emit(o.emitter.OBJECT_LOADED,a.data),T.setFormToCompare(d.cloneObject(t))}),s.value=!1}async function A(){s.value=!0;const a=await C.getLists(n.value);d.validateResponse(a,null,()=>{T.setLists(a.data)}),s.value=!1}Y(()=>n.value,()=>{A()}),Q(async()=>{u.value=d.decodeId(f.params.serviceId),c.value=d.decodeId(f.params.serviceVersion),!u.value||!c.value?w.push({name:o.router.BACKOFFICE_SERVICE_PAGE.name}):(await A(),await G(),V.value&&(await g.value.getHistory(),g.value.setActiveVersion(c.value),g.value.setStep()))});const V=h(()=>!F.value&&M.value&&l.recordStateTypeId!=m.recordStateType.draft);return(a,t)=>{const _=E("breadcrumb-item"),D=E("breadcrumb"),N=E("ctimeline"),H=E("page");return p(),v(H,{title:a._lang.backoffice.service.editPageTitle},{breadcrumb:b(()=>[I(D,{"has-home":!e(y)},{default:b(()=>[e(F)?(p(),v(_,{key:0,label:a._lang.backoffice.tasks.breadcrumbTitle,"router-path":e(o).router.BACKOFFICE_TASKS_PAGE.path},null,8,["label","router-path"])):e(y)?(p(),v(_,{key:1,label:a._lang.search.pageTitle,"router-path":e(o).router.BACKOFFICE_SEARCH_HISTORY_PAGE.path},null,8,["label","router-path"])):(p(),v(_,{key:2,label:a._lang.backoffice.service.breadcrumbTitle,"router-path":e(o).router.BACKOFFICE_SERVICE_PAGE.path},null,8,["label","router-path"])),I(_,{label:a._lang.backoffice.service.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:b(()=>[I(Z,{loading:e(s),"onUpdate:loading":t[0]||(t[0]=i=>R(s)?s.value=i:s=i),selectedLang:e(n),"onUpdate:selectedLang":t[1]||(t[1]=i=>R(n)?n.value=i:n=i),service:e(C),backRoute:e(o).router.BACKOFFICE_SERVICE_PAGE.name,editRoute:e(o).router.BACKOFFICE_EDIT_SERVICE_PAGE.name,itemIdField:"serviceId",itemVersionField:"serviceVersion",itemId:e(u),itemVersion:e(c),formModel:e(l),"show-record-state-actions":e(F),store:e(T)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:b(()=>[e(V)?(p(),v(N,{versions:e(L),key:e(P),activeVersion:e(K),itemId:e(u),detailRoute:e(o).router.BACKOFFICE_DETAIL_SERVICE_PAGE.name,service:e(C),versionFieldName:"serviceVersion",dateFieldName:"serviceApprovedDate",detailRouteIdField:"serviceId",detailRouteVersionField:"serviceVersion",ref_key:"timeline",ref:g},null,8,["versions","activeVersion","itemId","detailRoute","service"])):W("",!0),I(j,{formModel:e(l),"onUpdate:formModel":t[2]||(t[2]=i=>R(l)?l.value=i:l=i),disabled:!0,loading:e(s),selectedLang:e(n),validateForm:!0,rules:e(B),isExternalEdit:!1,showProgress:!1},null,8,["formModel","loading","selectedLang","rules"])]),_:1},8,["title"])}}};export{Fe as default};
