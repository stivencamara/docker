import{a as be}from"./comments-3b769030.js";import{x as ee,u as te,r as S,a as c,b as y,c as H,w as C,e as ge,t as P,d as n,f as o,A as s,_ as ye,L as _e,m as ve,y as Ce,I as F,n as l,s as p,o as he,j as ke,R as A,Y as Se,k as D,i as Ie,$ as we,P as Oe,F as V,z as Le,G as Te,g as M,B as De,a0 as Re,p as Me,l as $e}from"./index-920dbb37.js";import{_ as ze}from"./cancel-confirm-33e0b7cc.js";import{b as R}from"./helpers-4c156364.js";import{s as Fe}from"./settings-bb7269a2.js";import{e as x}from"./helpers-93ac209f.js";import{s as Ae}from"./helpers-65b02008.js";import{h as je}from"./helpers-952742ca.js";import{d as Be}from"./helpers-cd5e71d3.js";import{p as Ee}from"./helpers-db4b16e6.js";/* empty css                                                                     */const Ne={__name:"publish-confirm",props:{id:{String,required:!0,default:"confirm-publish"},action:{Function,required:!0}},setup(_){const I=_;ee(),te();let e=S(!1);function j(){I.action()}return(u,B)=>{const w=c("cbutton"),$=c("modal");return y(),H($,{id:I.id,title:u._lang.common.publish,size:o(s).modalSize.medium},{body:C(()=>[ge(P(u._lang.backoffice.modals.confirmPublish),1)]),footer:C(()=>[n(w,{title:u._lang.common.no,type:o(s).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:o(e)},null,8,["title","type","disabled"]),n(w,{title:u._lang.common.yes,onClick:j,disabled:o(e),"data-bs-dismiss":"modal","aria-label":"Close"},null,8,["title","disabled"])]),_:1},8,["id","title","size"])}}},qe=_=>(Me("data-v-a2e133bf"),_=_(),$e(),_),Ve={key:0,class:"h-100",errors:""},He={class:"d-flex"},Pe={class:"me-2 mt-2 p-hand"},Ke={class:"field w-100"},Ue={class:"mb-0"},We={class:"d-block mb-2 text-danger"},Ge=qe(()=>M("hr",{class:"separator"},null,-1)),Qe={__name:"edit-actions",props:{loading:{Boolean,required:!0},canSubmit:{Boolean,required:!0},selectedLang:{type:[String,Number],required:!0},formModel:{type:Object,required:!0},service:{type:Object,required:!0},backRoute:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemVersion:{type:[String,Number],required:!0},vuelidate:{type:Object,required:!0},store:{type:Object,required:!0},resource:{type:Object},directBackRoute:{Boolean,default:!1},itemIdField:{type:String,required:!0}},emits:["update:selectedLang","update:loading"],setup(_,{emit:I}){const e=_;_e(async()=>{await ne()});const j=ve(),u=ee(),B="confirm-delete",w="confirm-cancel",$="confirm-publish",oe=`#${B}_modal`,f=te();let K=S([]),U=S(!1),W=Ce({});const G=F(()=>{if(e.vuelidate.$error){U.value=!0;const t=l.removeDuplicateItemsOfArray(e.vuelidate.$errors),a=t.map(r=>({name:r.$property,group:r.$propertyPath,message:r.$message})),b=t.find(r=>r.$property==="texts");if(b){for(let r in b.$response.$data){let m=b.$response.$data[r];const v=Object.keys(m);for(let g in v){const L=v[g];m[L].$error&&a.push({name:L,group:`texts.${L}`,message:u.common.requiredField})}}l.removeItemOfArray(a,a.find(r=>r.name==="texts"))}const k=l.removeDuplicateItemsOfArray(a),q=R.getObjecTypeId(e.formModel);let z=[],d=x.progressFields();switch(q){case s.objectType.organization:d=x.progressFields();break;case s.objectType.service:d=Ae.progressFields();break;case s.objectType.document:d=Be.progressFields();break;case s.objectType.location:d=je.progressFields();break;case s.objectType.pointOfCare:d=Ee.progressFields();break}for(let r in d){let m=d[r];if(m.includes(".")){const g=m.split(".");m=g[g.length-1]}const v=k.find(g=>g.name===m);v&&z.push(v)}return z}else return U.value&&f.emit(p.emitter.OFFCANVAS_CLOSE),[]});he(()=>{Object.assign(W,e.formModel),f.on(p.emitter.DUPLICATE_NAMES,async t=>{t?await se():N.value=null})}),ke(()=>{f.off(p.emitter.DUPLICATE_NAMES)});const O=F({get(){return e.selectedLang},set(t){I("update:selectedLang",t)}}),se=async()=>{if((await e.service.changeState(e.itemId,e.itemVersion,s.recordStateType.published,N.value)).code===s.responseCode.success){const a=R.getObjecTypeId(e.formModel),b=R.getMessage(u,s.recordStateType.published,a);A.success(b),h()}},ae=t=>{const a=document.getElementById(t.name);a?(f.emit(p.emitter.OFFCANVAS_CLOSE),a.focus()):console.error(`The element not founded with id: ${t.name}`)},i=F({get(){return e.loading},set(t){I("update:loading",t)}});async function ne(){let t=await Fe.getLanguages();l.validateResponse(t,null,()=>{K.value=t.data})}async function ie(){i.value=!0;const t=await e.service.delete(e.itemId,e.itemVersion);l.validateResponse(t,e.resource.deleted,()=>{h()}),i.value=!1}function le(){l.compareObjectIsDirty(e.store.formToCompare,e.formModel)?l.showModalById(w):h()}function re(){l.showModalById($)}function ce(){h()}async function Q(){i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error?X():A.success(u.common.formIsValid),i.value=!1}async function E(){i.value=!0;const t=await e.service.update(e.formModel);l.validateResponse(t,e.resource.saved,()=>{Object.assign(W,e.formModel),e.store.setFormToCompare(e.formModel)}),i.value=!1}async function de(){if(i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error)X();else{const t=await e.service.update(e.formModel);l.validateResponse(t,null,async()=>{const a=await e.service.submit(e.itemId,e.itemVersion);l.validateResponse(a,e.resource.saved,()=>{a.code===0&&h()}),i.value=!1})}i.value=!1}let Y=S(l.createEmptyDataSource()),N=S(null);async function ue(){if(i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error)f.emit(p.emitter.ACCORDION_COLLAPSE_ALL),f.emit(p.emitter.SHOW_ERROR_CLICK),A.warning(u.common.requiredFields);else{const t=await e.service.update(e.formModel);l.validateResponse(t,null,async()=>{const a=await e.service.publish(e.itemId,e.itemVersion);a.code===s.responseCode.success?h():a.code===s.responseCode.organizationDuplicate||a.code===s.responseCode.locationDuplicate||a.code===s.responseCode.pointOfCareDuplicate||a.code===s.responseCode.documentDuplicate||a.code===s.responseCode.serviceDuplicate?(N.value=a.data.key,Y.value=l.createEmptyDataSource(a.data.newListDuplicates),l.showModalById("duplicated-names")):l.showErrorToastByResponseCode(a.code),i.value=!1})}i.value=!1}let J=S(!1);function me(t){J.value=t.width<576}function X(){f.emit(p.emitter.ACCORDION_COLLAPSE_ALL),f.emit(p.emitter.SHOW_ERROR_CLICK),A.warning(u.common.requiredFields)}function h(){let t={name:e.backRoute};e.directBackRoute&&(t={path:e.backRoute}),j.push(t)}const pe=F({get(){return R.getFieldByLangAndName(e.formModel,O.value,"name")},set(t){R.setFieldByLangAndName(e.formModel,O.value,"name",t)}});return(t,a)=>{const b=c("Hotkeys"),k=c("cbutton"),q=c("lang-selector"),z=c("iconArrowRight"),d=c("cbutton-options-item"),r=c("iconTrash"),m=c("cbutton-options-separator"),v=c("iconSubmmit"),g=c("cbutton-options"),L=c("confirm-delete-modal"),Z=c("icon-focus"),fe=Se("resize");return y(),D(V,null,[n(b,{shortcuts:["S"],debug:!0,onTriggered:E}),n(k,{class:"col-12 col-sm-auto",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,title:t._lang.common.cancel,onClick:le,disabled:o(i)},null,8,["type","size","title","disabled"]),n(q,{options:o(K),selectedLang:o(O),"onUpdate:selectedLang":a[0]||(a[0]=T=>Ie(O)?O.value=T:null),disabled:o(i)},null,8,["options","selectedLang","disabled"]),n(k,{class:"col-12 col-sm-auto",title:t._lang.common.save,type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:E,disabled:o(i)},null,8,["title","type","size","disabled"]),n(k,{class:"col-12 col-sm-auto d-sm-block d-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:Q,disabled:o(i),icon:we,"icon-color":"#002D74","data-bs-toggle":"tooltip","data-bs-title":t._lang.common.verify,"data-bs-placement":"top"},null,8,["type","size","disabled","data-bs-title"]),n(k,{class:"col-12 col-sm-auto d-sm-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:Q,disabled:o(i),title:t._lang.common.verify},null,8,["type","size","disabled","title"]),Oe((y(),H(g,{title:t._lang.common.actions,size:o(s).buttonSize.large,type:o(s).buttonType.secondary,disabled:o(i),class:Le({"dropdown-center":o(J)})},{default:C(()=>[e.formModel.recordStateTypeId===o(s).recordStateType.approval?(y(),H(d,{key:0,title:t._lang.common.publish,disabled:!e.canSubmit,onClick:re},{default:C(()=>[n(z,{color:"#002D74"})]),_:1},8,["title","disabled"])):(y(),D(V,{key:1},[n(d,{title:t._lang.common.delete,"data-bs-target":oe,"data-bs-toggle":"modal"},{default:C(()=>[n(r,{color:"#002D74"})]),_:1},8,["title"]),n(m),n(d,{title:t._lang.common.submit,disabled:!e.canSubmit,onClick:de},{default:C(()=>[n(v,{color:"#002D74"})]),_:1},8,["title","disabled"])],64))]),_:1},8,["title","size","type","disabled","class"])),[[fe,me]]),n(L,{id:B,title:e.resource.delete,message:e.resource.deleteQuestion,action:ie},null,8,["title","message"]),n(ze,{id:w,title:t._lang.common.cancel,action:ce},null,8,["title"]),n(Ne,{id:$,title:t._lang.common.publish,action:ue},null,8,["title"]),n(b,{shortcuts:["S"],debug:!0,onTriggered:E}),n(Re,{title:t._lang.widgets.errors,type:o(s).offcanvas.danger,emitter:o(p).emitter.SHOW_ERROR_CLICK},{default:C(()=>[o(G).length?(y(),D("div",Ve,[(y(!0),D(V,null,Te(o(G),(T,Ye)=>(y(),D("div",He,[M("div",Pe,[n(Z,{color:"#002D74",class:"p-hand",onClick:Je=>ae(T)},null,8,["onClick"])]),M("div",Ke,[M("h6",Ue,P(t._lang.label[T.name]),1),M("span",We,P(T.message),1),Ge])]))),256))])):De("",!0)]),_:1},8,["title","type","emitter"]),n(be,{"data-source":o(Y),name:o(pe)},null,8,["data-source","name"])],64)}}},rt=ye(Qe,[["__scopeId","data-v-a2e133bf"]]);export{rt as e};
