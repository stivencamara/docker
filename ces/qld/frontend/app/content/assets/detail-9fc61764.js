import{K as z,j as C,l as i,b as U,i as n,s as R,v as E,q as j,h as J,C as Y,D as x,E as F,M as Q,N as B,r as c,o as m,c as p,w as f,a as d,m as e,z as A,y as W}from"./index-d8a56bcc.js";import{u as X,_ as Z,a as $}from"./address-b7b6f18d.js";import{a as ee}from"./refusal-a1b91175.js";import{c as ae,r as te}from"./index.esm-d77c3574.js";import{l as g}from"./location-ff83fe07.js";import{h as L}from"./helpers-3cc5802d.js";import{b as oe}from"./helpers-d89764d1.js";/* empty css                                                                     */import{_ as le}from"./detail-actions-61125ebe.js";import"./address-e1a94fd0.js";import"./helpers-a03e04a5.js";import"./helpers-1cb82c85.js";import"./helpers-71f72544.js";import"./helpers-eb16543c.js";import"./helpers-84e67dcb.js";import"./settings-55cfd82c.js";const Ae={__name:"detail",setup(re){z(async()=>{u.value=C.decodeId(b.params.locationId),_.value=C.decodeId(b.params.locationVersion),!u.value||!_.value?S.push({name:i.router.BACKOFFICE_LOCATION_PAGE.name}):(await w(),await D(),k.value&&(await v.value.getHistory(),v.value.setActiveVersion(g.value),v.value.setStep()))}),U(()=>{l.value=!1});let u=n(0),_=n(0),l=n(!0);n([]);let a=R(L.newForm()),r=n(E.language.pt),V=R(L.formRules()),T=n(0),v=n(null);const O=X(),P=j(),S=J(),b=Y(),N=x();ae.withMessage(P.common.requiredField,te);const h=F(()=>b.path.toLowerCase().indexOf("tarefas")>-1),y=F(()=>b.path.toLowerCase().indexOf("pesquisa")>-1),K=n(Q.havePermission(E.permissions.organization.createEdit)),k=F(()=>!h.value&&K.value&&a.recordStateTypeId!=E.recordStateType.draft);async function D(){const t=await g.getById(u.value,_.value);C.validateResponse(t,null,()=>{Object.assign(a,t.data),N.emit(i.emitter.OBJECT_LOADED,t.data)})}async function w(){l.value=!0;const t=await g.getLists(r.value);C.validateResponse(t,null,()=>{O.setLists(t.data)}),l.value=!1}return B(()=>r.value,()=>{w()}),B(()=>[a.code,a.startDate,a.zipCode,a.islandId,a.countyId,a.parishId,a.locationTypeId,a.locationId,a.organizationId,a.address,a.locality],()=>{oe.calculatePercentage(a,L.progressFields(),t=>{O.setProgress(t),T.value=t})}),F(()=>T.value===100&&!l.value),(t,s)=>{const I=c("breadcrumb-item"),G=c("breadcrumb"),M=c("ctimeline"),H=c("card"),q=c("page");return m(),p(q,{title:t._lang.backoffice.location.detailPageTitle},{breadcrumb:f(()=>[d(G,{"has-home":!e(y)},{default:f(()=>[e(h)?(m(),p(I,{key:0,label:t._lang.backoffice.tasks.breadcrumbTitle,"router-path":e(i).router.BACKOFFICE_TASKS_PAGE.path},null,8,["label","router-path"])):e(y)?(m(),p(I,{key:1,label:t._lang.search.pageTitle,"router-path":e(i).router.BACKOFFICE_SEARCH_HISTORY_PAGE.path},null,8,["label","router-path"])):(m(),p(I,{key:2,label:t._lang.backoffice.location.breadcrumbTitle,"router-path":e(i).router.BACKOFFICE_LOCATION_PAGE.path},null,8,["label","router-path"])),d(I,{label:t._lang.backoffice.location.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:f(()=>[d(le,{loading:e(l),selectedLang:e(r),"onUpdate:selectedLang":s[0]||(s[0]=o=>A(r)?r.value=o:r=o),service:e(g),backRoute:e(i).router.BACKOFFICE_LOCATION_PAGE.name,editRoute:e(i).router.BACKOFFICE_EDIT_LOCATION_PAGE.name,itemIdField:"locationId",itemVersionField:"locationVersion",itemId:e(u),itemVersion:e(_),formModel:e(a),"show-record-state-actions":e(h),store:e(O)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:f(()=>[e(k)?(m(),p(M,{key:0,itemId:e(u),detailRoute:e(i).router.BACKOFFICE_DETAIL_LOCATION_PAGE.name,service:e(g),versionFieldName:"locationVersion",dateFieldName:"locationApprovedDate",detailRouteIdField:"locationId",detailRouteVersionField:"locationVersion",ref_key:"timeline",ref:v},null,8,["itemId","detailRoute","service"])):W("",!0),d(H,{shadow:!0},{body:f(()=>[d(Z,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":s[1]||(s[1]=o=>A(a)?a.value=o:a=o),loading:e(l),rules:e(V),selectedLang:e(r),vuelidate:{}},null,8,["modelValue","loading","rules","selectedLang"]),d($,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":s[2]||(s[2]=o=>A(a)?a.value=o:a=o),loading:e(l),rules:e(V),vuelidate:{}},null,8,["modelValue","loading","rules"]),d(ee,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":s[3]||(s[3]=o=>A(a)?a.value=o:a=o),loading:e(l),selectedLang:e(r),vuelidate:{}},null,8,["modelValue","loading","selectedLang"])]),_:1})]),_:1},8,["title"])}}};export{Ae as default};
