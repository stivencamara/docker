import{_ as U}from"./general-d2e7a8a8.js";import{h as G,C as H,q as j,D as q,i as l,s as V,v as I,E as F,N as z,K as Y,j as g,l as n,M as x,r as m,o as b,c as C,w as c,a as p,m as e,z as h,y as J}from"./index-60da5de7.js";import{d as _}from"./document-366775b4.js";import{d as L}from"./helpers-7879846e.js";import{u as Q}from"./document-60dffbf9.js";import"./helpers-870863ae.js";import{_ as W}from"./detail-actions-425b6347.js";import"./index.esm-61763a8c.js";import"./refusal-f8d08513.js";import"./index.esm-eed786a6.js";import"./generic-f0c11361.js";import"./helpers-a90cb10f.js";import"./helpers-2fddf39f.js";import"./helpers-08b5b49a.js";import"./helpers-06820a25.js";import"./helpers-48506bdb.js";import"./settings-bac024a5.js";const fe={__name:"detail",setup(X){const y=G(),f=H();j();const k=q(),O=Q();let a=l(!0),r=V(L.newForm()),s=l(I.language.pt),B=V(L.formRules()),u=l(0),d=l(0),v=l(null);const T=F(()=>f.path.toLowerCase().indexOf("tarefas")>-1),A=F(()=>f.path.toLowerCase().indexOf("pesquisa")>-1);async function D(){a.value=!0;const t=await _.getById(u.value,d.value);g.validateResponse(t,null,()=>{Object.assign(r,t.data),k.emit(n.emitter.OBJECT_LOADED,t.data)}),a.value=!1}async function R(){a.value=!0;const t=await _.getLists(s.value,d.value);g.validateResponse(t,null,()=>{O.setLists(t.data)}),a.value=!1}z(()=>s.value,()=>{R()}),Y(async()=>{u.value=g.decodeId(f.params.documentId),d.value=g.decodeId(f.params.documentVersion),!u.value||!d.value?y.push({name:n.router.BACKOFFICE_DOCUMENT_PAGE.name}):(await R(),await D(),w.value&&(await v.value.getHistory(),v.value.setActiveVersion(_.value),v.value.setStep()))});const N=l(x.havePermission(I.permissions.organization.createEdit)),w=F(()=>!T.value&&N.value&&r.recordStateTypeId!=I.recordStateType.draft);return(t,i)=>{const E=m("breadcrumb-item"),M=m("breadcrumb"),P=m("ctimeline"),S=m("card"),K=m("page");return b(),C(K,{title:t._lang.backoffice.document.detailPageTitle},{breadcrumb:c(()=>[p(M,{"has-home":!e(A)},{default:c(()=>[e(A)?(b(),C(E,{key:0,label:t._lang.search.pageTitle,"router-path":e(n).router.BACKOFFICE_SEARCH_HISTORY_PAGE.path},null,8,["label","router-path"])):(b(),C(E,{key:1,label:t._lang.backoffice.document.breadcrumbTitle,"router-path":e(n).router.BACKOFFICE_DOCUMENT_PAGE.path},null,8,["label","router-path"])),p(E,{label:t._lang.backoffice.document.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:c(()=>[p(W,{loading:e(a),"onUpdate:loading":i[0]||(i[0]=o=>h(a)?a.value=o:a=o),selectedLang:e(s),"onUpdate:selectedLang":i[1]||(i[1]=o=>h(s)?s.value=o:s=o),service:e(_),backRoute:e(n).router.BACKOFFICE_DOCUMENT_PAGE.name,editRoute:e(n).router.BACKOFFICE_EDIT_DOCUMENT_PAGE.name,itemIdField:"documentId",itemVersionField:"documentVersion",itemId:e(u),itemVersion:e(d),formModel:e(r),"show-record-state-actions":e(T),store:e(O)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:c(()=>[e(w)?(b(),C(P,{key:0,itemId:e(u),detailRoute:e(n).router.BACKOFFICE_DETAIL_ENTITY_PAGE.name,service:e(_),versionFieldName:"documentVersion",dateFieldName:"documentApprovedDate",detailRouteIdField:"documentId",detailRouteVersionField:"documentVersion",ref_key:"timeline",ref:v},null,8,["itemId","detailRoute","service"])):J("",!0),p(S,{shadow:!0},{body:c(()=>[p(U,{modelValue:e(r),"onUpdate:modelValue":i[2]||(i[2]=o=>h(r)?r.value=o:r=o),disabled:!0,loading:e(a),selectedLang:e(s),validateForm:!0,rules:e(B)},null,8,["modelValue","loading","selectedLang","rules"])]),_:1})]),_:1},8,["title"])}}};export{fe as default};
