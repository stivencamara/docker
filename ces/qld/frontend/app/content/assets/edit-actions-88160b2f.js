import{b as ye}from"./refusal-5d03193c.js";import{z as K,M as U,r as S,b as c,o as b,l as B,w as g,W as se,t as E,e as n,g as o,i as s,_ as ve,J as Ce,s as he,a as ke,G as j,u as l,x as f,n as Se,q as Ie,Q as q,Y as Oe,c as z,D as we,$ as Te,O as De,F as P,A as Le,j as Me,d as R,B as ze,a0 as $e,p as Re,k as Fe}from"./index-5b4ebf84.js";import{_ as Ae}from"./cancel-confirm-46a9e596.js";import{b as $}from"./helpers-4796f1a9.js";import{s as je}from"./settings-fd6ffbf1.js";import{o as oe}from"./helpers-991a1d67.js";import{s as qe}from"./helpers-28a0442c.js";import{h as Be}from"./helpers-c8652456.js";import{d as Ee}from"./helpers-138c884f.js";import{p as Ne}from"./helpers-56107f9e.js";/* empty css                                                                     */const Ve={__name:"publish-confirm",props:{id:{String,required:!0,default:"confirm-publish"},action:{Function,required:!0}},setup(m){const _=m;K(),U();let e=S(!1);function T(){_.action()}return(r,F)=>{const y=c("cbutton"),I=c("modal");return b(),B(I,{id:_.id,title:r._lang.common.publish,size:o(s).modalSize.medium},{body:g(()=>[se(E(r._lang.backoffice.modals.confirmPublish),1)]),footer:g(()=>[n(y,{title:r._lang.common.no,type:o(s).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:o(e)},null,8,["title","type","disabled"]),n(y,{title:r._lang.common.yes,onClick:T,disabled:o(e),"data-bs-dismiss":"modal","aria-label":"Close"},null,8,["title","disabled"])]),_:1},8,["id","title","size"])}}},He={__name:"submit-confirm",props:{id:{String,required:!0,default:"confirm-submit"},action:{Function,required:!0}},setup(m){const _=m;K(),U();let e=S(!1);function T(){_.action()}return(r,F)=>{const y=c("cbutton"),I=c("modal");return b(),B(I,{id:_.id,title:r._lang.common.submit,size:o(s).modalSize.medium},{body:g(()=>[se(E(r._lang.backoffice.modals.confirmSubmit),1)]),footer:g(()=>[n(y,{title:r._lang.common.no,type:o(s).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:o(e)},null,8,["title","type","disabled"]),n(y,{title:r._lang.common.yes,onClick:T,disabled:o(e),"data-bs-dismiss":"modal","aria-label":"Close"},null,8,["title","disabled"])]),_:1},8,["id","title","size"])}}},Pe=m=>(Re("data-v-e4fbd189"),m=m(),Fe(),m),Ke={key:0,class:"h-100",errors:""},Ue={class:"d-flex"},We={class:"me-2 mt-2 p-hand"},Qe={class:"field w-100"},Ge={class:"mb-0"},Je={class:"d-block mb-2 text-danger"},Ye=Pe(()=>R("hr",{class:"separator"},null,-1)),Xe={__name:"edit-actions",props:{loading:{Boolean,required:!0},canSubmit:{Boolean,required:!0},selectedLang:{type:[String,Number],required:!0},formModel:{type:Object,required:!0},service:{type:Object,required:!0},backRoute:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemVersion:{type:[String,Number],required:!0},vuelidate:{type:Object,required:!0},store:{type:Object,required:!0},resource:{type:Object},directBackRoute:{Boolean,default:!1},itemIdField:{type:String,required:!0}},emits:["update:selectedLang","update:loading"],setup(m,{emit:_}){const e=m;Ce(async()=>{await re()});const T=he(),r=K(),F="confirm-delete",y="confirm-cancel",I="confirm-publish",W="confirm-submit",ae=`#${F}_modal`,ne=`#${W}_modal`,v=U();let Q=S([]),G=S(!1),J=ke({});const Y=j(()=>{if(e.vuelidate.$error){G.value=!0;const t=l.removeDuplicateItemsOfArray(e.vuelidate.$errors),a=t.map(d=>({name:d.$property,group:d.$propertyPath,message:d.$message})),C=t.find(d=>d.$property==="texts");if(C){for(let d in C.$response.$data){let p=C.$response.$data[d];const k=Object.keys(p);for(let h in k){const L=k[h];p[L].$error&&a.push({name:L,group:`texts.${L}`,message:r.common.requiredField})}}l.removeItemOfArray(a,a.find(d=>d.name==="texts"))}const w=l.removeDuplicateItemsOfArray(a),H=$.getObjecTypeId(e.formModel);let A=[],u=oe.progressFields();switch(H){case s.objectType.organization:u=oe.progressFields();break;case s.objectType.service:u=qe.progressFields();break;case s.objectType.document:u=Ee.progressFields();break;case s.objectType.location:u=Be.progressFields();break;case s.objectType.pointOfCare:u=Ne.progressFields();break}for(let d in u){let p=u[d];if(p.includes(".")){const h=p.split(".");p=h[h.length-1]}const k=w.find(h=>h.name===p);k&&A.push(k)}return A}else return G.value&&v.emit(f.emitter.OFFCANVAS_CLOSE),[]});Se(()=>{Object.assign(J,e.formModel),v.on(f.emitter.DUPLICATE_NAMES,async t=>{t?await ie():V.value=null})}),Ie(()=>{v.off(f.emitter.DUPLICATE_NAMES)});const D=j({get(){return e.selectedLang},set(t){_("update:selectedLang",t)}}),ie=async()=>{if((await e.service.changeState(e.itemId,e.itemVersion,s.recordStateType.published,V.value)).code===s.responseCode.success){const a=$.getObjecTypeId(e.formModel),C=$.getMessage(r,s.recordStateType.published,a);q.success(C),O()}},le=t=>{const a=document.getElementById(t.name);a?(v.emit(f.emitter.OFFCANVAS_CLOSE),a.focus()):console.error(`The element not founded with id: ${t.name}`)},i=j({get(){return e.loading},set(t){_("update:loading",t)}});async function re(){let t=await je.getLanguages();l.validateResponse(t,null,()=>{Q.value=t.data})}async function ce(){i.value=!0;const t=await e.service.delete(e.itemId,e.itemVersion);l.validateResponse(t,e.resource.deleted,()=>{O()}),i.value=!1}function de(){l.compareObjectIsDirty(e.store.formToCompare,e.formModel)?l.showModalById(y):O()}function ue(){l.showModalById(I)}function me(){O()}async function X(){i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error?ee():q.success(r.common.formIsValid),i.value=!1}async function N(){i.value=!0;const t=await e.service.update(e.formModel);l.validateResponse(t,e.resource.saved,()=>{Object.assign(J,e.formModel),e.store.setFormToCompare(e.formModel)}),i.value=!1}async function pe(){if(i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error)ee();else{const t=await e.service.update(e.formModel);l.validateResponse(t,null,async()=>{const a=await e.service.submit(e.itemId,e.itemVersion);l.validateResponse(a,e.resource.saved,()=>{a.code===0&&O()}),i.value=!1})}i.value=!1}let Z=S(l.createEmptyDataSource()),V=S(null);async function fe(){if(i.value=!0,await e.vuelidate.$validate(),e.vuelidate.$error)v.emit(f.emitter.ACCORDION_COLLAPSE_ALL),v.emit(f.emitter.SHOW_ERROR_CLICK),q.warning(r.common.requiredFields);else{const t=await e.service.update(e.formModel);l.validateResponse(t,null,async()=>{const a=await e.service.publish(e.itemId,e.itemVersion);a.code===s.responseCode.success?O():a.code===s.responseCode.organizationDuplicate||a.code===s.responseCode.locationDuplicate||a.code===s.responseCode.pointOfCareDuplicate||a.code===s.responseCode.documentDuplicate||a.code===s.responseCode.serviceDuplicate?(V.value=a.data.key,Z.value=l.createEmptyDataSource(a.data.newListDuplicates),l.showModalById("duplicated-names")):l.showErrorToastByResponseCode(a.code),i.value=!1})}i.value=!1}let x=S(!1);function be(t){x.value=t.width<576}function ee(){v.emit(f.emitter.ACCORDION_COLLAPSE_ALL),v.emit(f.emitter.SHOW_ERROR_CLICK),q.warning(r.common.requiredFields)}function O(){let t={name:e.backRoute};e.directBackRoute&&(t={path:e.backRoute}),T.push(t)}const ge=j({get(){return $.getFieldByLangAndName(e.formModel,D.value,"name")},set(t){$.setFieldByLangAndName(e.formModel,D.value,"name",t)}});return(t,a)=>{const C=c("Hotkeys"),w=c("cbutton"),H=c("lang-selector"),A=c("iconArrowRight"),u=c("cbutton-options-item"),d=c("iconSubmmit"),p=c("cbutton-options-separator"),k=c("iconTrash"),h=c("cbutton-options"),L=c("confirm-delete-modal"),te=c("icon-focus"),_e=Oe("resize");return b(),z(P,null,[n(C,{shortcuts:["S"],debug:!0,onTriggered:N}),n(w,{class:"col-12 col-sm-auto",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,title:t._lang.common.cancel,onClick:de,disabled:o(i)},null,8,["type","size","title","disabled"]),n(H,{options:o(Q),selectedLang:o(D),"onUpdate:selectedLang":a[0]||(a[0]=M=>we(D)?D.value=M:null),disabled:o(i)},null,8,["options","selectedLang","disabled"]),n(w,{class:"col-12 col-sm-auto",title:t._lang.common.save,type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:N,disabled:o(i)},null,8,["title","type","size","disabled"]),n(w,{class:"col-12 col-sm-auto d-sm-block d-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:X,disabled:o(i),icon:Te,"icon-color":"#002D74","data-bs-toggle":"tooltip","data-bs-title":t._lang.common.verify,"data-bs-placement":"top"},null,8,["type","size","disabled","data-bs-title"]),n(w,{class:"col-12 col-sm-auto d-sm-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:X,disabled:o(i),title:t._lang.common.verify},null,8,["type","size","disabled","title"]),De((b(),B(h,{title:t._lang.common.actions,size:o(s).buttonSize.large,type:o(s).buttonType.secondary,disabled:o(i),class:Le({"dropdown-center":o(x)})},{default:g(()=>[e.formModel.recordStateTypeId===o(s).recordStateType.approval?(b(),B(u,{key:0,title:t._lang.common.publish,disabled:!e.canSubmit,onClick:ue},{default:g(()=>[n(A,{color:"#002D74"})]),_:1},8,["title","disabled"])):(b(),z(P,{key:1},[n(u,{title:t._lang.common.submit,disabled:!e.canSubmit,"data-bs-target":ne,"data-bs-toggle":"modal"},{default:g(()=>[n(d,{color:"#002D74"})]),_:1},8,["title","disabled"]),n(p),n(u,{title:t._lang.common.delete,"data-bs-target":ae,"data-bs-toggle":"modal"},{default:g(()=>[n(k,{color:"#002D74"})]),_:1},8,["title"])],64))]),_:1},8,["title","size","type","disabled","class"])),[[_e,be]]),n(L,{id:F,title:e.resource.delete,message:e.resource.deleteQuestion,action:ce},null,8,["title","message"]),n(Ae,{id:y,title:t._lang.common.cancel,action:me},null,8,["title"]),n(Ve,{id:I,title:t._lang.common.publish,action:fe},null,8,["title"]),n(He,{id:W,title:t._lang.common.submit,action:pe},null,8,["title"]),n(C,{shortcuts:["S"],debug:!0,onTriggered:N}),n($e,{title:t._lang.widgets.errors,type:o(s).offcanvas.danger,emitter:o(f).emitter.SHOW_ERROR_CLICK},{body:g(()=>[o(Y).length?(b(),z("div",Ke,[(b(!0),z(P,null,Me(o(Y),(M,Ze)=>(b(),z("div",Ue,[R("div",We,[n(te,{color:"#002D74",class:"p-hand",onClick:xe=>le(M)},null,8,["onClick"])]),R("div",Qe,[R("h6",Ge,E(t._lang.label[M.name]),1),R("span",Je,E(M.message),1),Ye])]))),256))])):ze("",!0)]),_:1},8,["title","type","emitter"]),n(ye,{"data-source":o(Z),name:o(ge)},null,8,["data-source","name"])],64)}}},ut=ve(Xe,[["__scopeId","data-v-e4fbd189"]]);export{ut as e};
