import{_ as H}from"./general-203b30e5.js";import{g as Y,f as q,i as $,r as s,j as V,v as T,k as w,w as O,N as J,u as m,C as p,l as f,c as C,e as k,q as o,n as g,s as e,F as y,L as A}from"./index-bb041a92.js";import{d as I}from"./document-da1af287.js";import{d as h}from"./helpers-b7ce43f3.js";import{u as Q}from"./document-e6f9be11.js";import{u as W}from"./index.esm-aaed56ca.js";import{b as X}from"./helpers-f0eb2667.js";import{e as Z}from"./edit-actions-7faa71d8.js";import{_ as x}from"./unsaved-f8ab89eb.js";import"./refusal-4a9e82b8.js";import"./index.esm-70b2cee2.js";import"./generic-a6ce2963.js";import"./cancel-confirm-91946768.js";import"./settings-7b62b456.js";/* empty css                                                                     */const be={__name:"edit",setup(ee){const R=Y(),b=q(),S=$(),d=Q();let r=s(!0),t=V(h.newForm()),u=s(T.language.pt);s([]);let B=V(h.formRules()),_=s(0),E=s(0),c=s(0),v=s(0),F=s([]);const M=W(B,t),z=w(()=>E.value===100&&!r.value);async function N(){r.value=!0;let a=await I.getById(_.value,v.value);m.validateResponse(a,null,async()=>{Object.assign(t,a.data),d.setFormToCompare(m.cloneObject(a.data))}),r.value=!1}async function L(){r.value=!0;const a=await I.getLists(u.value,t.recordStateTypeId!==T.recordStateType.draft,t.organization);m.validateResponse(a,null,()=>{d.setLists(a.data)}),r.value=!1}O(()=>u.value,()=>{L()}),J(async()=>{_.value=m.decodeId(b.params.documentId),v.value=m.decodeId(b.params.documentVersion),c.value=m.decodeId(b.params.organizationId),!_.value||!v.value?R.push({name:p.router.BACKOFFICE_DOCUMENT_PAGE.name}):(await N(),await L())}),O(()=>[t.texts[0].name,t.organization,t.documentTypeId,t.startDate,t.document],()=>{F.value=h.progressFields(),X.calculatePercentage(t,F.value,a=>{d.setProgress(a),E.value=a})});const P=w(()=>{if(c.value>0){const a=d.organizationList.find(i=>i.value3.id===c.value);let l=p.router.BACKOFFICE_EDIT_ENTITY_PAGE.path;return(a==null?void 0:a.state)!=T.recordStateType.draft&&(l=p.router.BACKOFFICE_DETAIL_ENTITY_PAGE.path),`${l.replace(":organizationId",b.params.organizationId).replace(":organizationVersion",b.params.organizationVersion)}#documentos`}else return p.router.BACKOFFICE_DOCUMENT_PAGE.name});return(a,l)=>{const i=f("breadcrumb-item"),D=f("breadcrumb"),G=f("progress-bar"),K=f("container-wrapper"),U=f("card"),j=f("page");return C(),k(y,null,[o(j,{title:a._lang.backoffice.document.editPageTitle},{breadcrumb:g(()=>[o(D,{"has-home":!0},{default:g(()=>[e(c)>0?(C(),k(y,{key:0},[o(i,{label:a._lang.backoffice.entities.breadcrumbTitle,"router-path":e(p).router.BACKOFFICE_ENTITIES_PAGE.path},null,8,["label","router-path"]),o(i,{label:e(S).common.entity,"router-path":e(P)},null,8,["label","router-path"]),o(i,{label:a._lang.backoffice.document.editPageTitle},null,8,["label"])],64)):(C(),k(y,{key:1},[o(i,{label:a._lang.backoffice.document.breadcrumbTitle,"router-path":e(p).router.BACKOFFICE_DOCUMENT_PAGE.path},null,8,["label","router-path"]),o(i,{label:a._lang.backoffice.document.editPageTitle},null,8,["label"])],64))]),_:1})]),actions:g(()=>[o(Z,{loading:e(r),"onUpdate:loading":l[0]||(l[0]=n=>A(r)?r.value=n:r=n),canSubmit:e(z),selectedLang:e(u),"onUpdate:selectedLang":l[1]||(l[1]=n=>A(u)?u.value=n:u=n),backRoute:e(P),directBackRoute:e(c)>0,service:e(I),itemId:e(_),itemVersion:e(v),formModel:e(t),vuelidate:e(M),store:e(d),resource:a._lang.backoffice.document,itemIdField:"documentId",progressFields:e(F)},null,8,["loading","canSubmit","selectedLang","backRoute","directBackRoute","service","itemId","itemVersion","formModel","vuelidate","store","resource","progressFields"])]),default:g(()=>[o(U,{shadow:!0},{body:g(()=>[o(K,{"margin-top":!1},{default:g(()=>[o(G,{value:e(E),label:a._lang.common.fill,class:"mb-4 col-12 float-end"},null,8,["value","label"])]),_:1}),o(H,{modelValue:e(t),"onUpdate:modelValue":l[2]||(l[2]=n=>A(t)?t.value=n:t=n),disabled:!1,loading:e(r),selectedLang:e(u),validateForm:!0,rules:e(B),isExternalEdit:e(c)>0},null,8,["modelValue","loading","selectedLang","rules","isExternalEdit"])]),_:1})]),_:1},8,["title"]),o(x,{formModel:e(t),store:e(d),service:e(I),resource:a._lang.backoffice.document},null,8,["formModel","store","service","resource"])],64)}}};export{be as default};
