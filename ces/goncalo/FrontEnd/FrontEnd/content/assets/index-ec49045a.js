import{d as P,_ as G,K as j,a1 as H,h as x,r as b,u as L,k as n,c as r,e as g,m as t,p as e,F as k,n as l,w as i,t as J,v as T,l as B,y as z,ad as K,x as E,G as $,A as Q,B as W,i as X,a as Y,j as Z,H as O,s as _}from"./index-4fe030fb.js";import{i as C}from"./import-9d859fc1.js";const U=P("ImportStore",{state:()=>({importCodeList:[]}),getters:{},actions:{addImportCode(c){this.importCodeList.push(c)},revomeImportCodeById(c){const u=this.importCodeList.findIndex(y=>y.code===c);return u>-1?(this.importCodeList.splice(u,1),!0):!1},resetList(){this.importCodeList=[]}},persist:{enabled:!0,strategies:[{key:"params-import",storage:localStorage,paths:["importCodeList"]}]}});const D=c=>(Q("data-v-27090fa6"),c=c(),W(),c),ee=D(()=>t("span",{class:"label placeholder"},null,-1)),te=D(()=>t("span",{class:"counter placeholder"},null,-1)),ae={key:1},oe={class:"label col-9"},se={class:"col-3 card-date"},le={class:"progress"},ne=["aria-valuenow"],re={class:"table table-container"},ie=D(()=>t("thead",{class:"table-head"},[t("tr",null,[t("th",{class:"table-head-column"},"Descrição")])],-1)),ce={class:"table-body"},de={__name:"import-card",props:{item:{type:Object,required:!0},loading:{type:Boolean,default:!1}},setup(c){const u=c;j(async()=>{await I(),w=window.setInterval(async()=>{o.value<100&&await I()},4e3)}),H(()=>{window.clearInterval(w)});const y=U();x();var d=b(!1),o=b(0),a=b([]),w;async function I(){d.value=!0;const h=await C.get(u.item.code);L.validateResponse(h,null,()=>{try{const v=JSON.parse(h.data);console.log(v),o.value=v.Status,a.value=v.Errors}catch{y.revomeImportCodeById(u.item.code)}}),d.value=!1}return(h,v)=>{const m=n("icon-danger"),s=n("row"),p=n("accordion");return r(),g(k,null,[t("div",{class:$(["mb-3 row home-card placeholder-glow",{active:!1}])},[e(d)?(r(),g(k,{key:0},[ee,te],64)):(r(),g("div",ae,[l(s,{class:""},{default:i(()=>[t("h6",oe,[J(T(u.item.name)+" ",1),e(a).length>0?(r(),B(m,{key:0,class:"p-hand"})):z("",!0)]),t("div",se,T(e(L).formatDate(u.item.date,"DD/MM/yyyy hh:mm")),1)]),_:1}),l(s,{class:"mb-3"},{default:i(()=>[t("div",le,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:K({width:e(o)+"%"}),"aria-valuenow":e(o),"aria-valuemin":"0","aria-valuemax":"100"},T(e(o))+"% ",13,ne)])]),_:1}),e(a).length>0?(r(),B(p,{key:0,id:"errors",title:h._lang.common.errors,collapsed:!1,class:"mb-4 bg-transparent"},{default:i(()=>[l(s,null,{default:i(()=>[t("table",re,[ie,t("tbody",ce,[(r(!0),g(k,null,E(e(a),(V,S)=>(r(),g("tr",{key:S},[t("td",null,[t("span",null,T(V),1)])]))),128))])])]),_:1})]),_:1},8,["title"])):z("",!0)]))]),e(d)?z("",!0):(r(),g(k,{key:0},[],64))],64)}}},me=G(de,[["__scopeId","data-v-27090fa6"]]),pe={class:"col-12 hstack gap-2 mt-3"},ue={class:"mb-3 gap-5",cards:""},ve={__name:"index",setup(c){const u=X(),y=U();x();var d=b(!1),o=b(null),a=b(null),w=b([]);b([]),j(()=>{w.value=L.convertEnumToArray(u.enums.importType)}),Y(()=>{});const I=Z(()=>y.importCodeList);function h(){a.value=null,o.value=null}async function v(m){d.value=!0;let s={data:a.value.data,name:a.value.name},p=null;switch(o.value){case _.importType.organization:p=await C.organization(s);break;case _.importType.service:p=await C.service(s);break;case _.importType.location:p=await C.location(s);break;case _.importType.servicePoint:p=await C.pointOfCare(s);break}L.validateResponse(p,"Importação iniciada",()=>{y.addImportCode({name:a.value.name,code:p.data,date:new Date}),h()}),d.value=!1}return(m,s)=>{const p=n("breadcrumb-item"),V=n("breadcrumb"),S=n("form-field"),N=n("row"),F=n("cbutton"),M=n("accordion"),R=n("card"),q=n("page");return r(),B(q,{title:m._lang.backoffice.settings.import.pageTitle},{breadcrumb:i(()=>[l(V,{"has-home":!0},{default:i(()=>[l(p,{label:m._lang.backoffice.settings.import.pageTitle},null,8,["label"])]),_:1})]),default:i(()=>[l(R,{shadow:!0},{body:i(()=>[l(M,{id:"newImport",title:m._lang.common.newImport,collapsed:!0,class:"mb-4"},{default:i(()=>[l(N,null,{default:i(()=>[l(S,{id:"importType",class:"mb-3 col-12 col-lg-4",modelValue:e(o),"onUpdate:modelValue":s[0]||(s[0]=f=>O(o)?o.value=f:o=f),label:m._lang.label.objectType,loading:e(d),type:e(_).inputs.multiselect,placeholder:m._lang.common.selectOption,options:e(w)},null,8,["modelValue","label","loading","type","placeholder","options"]),l(S,{id:"document",class:"mb-3 col-12 col-lg-8",modelValue:e(a),"onUpdate:modelValue":s[1]||(s[1]=f=>O(a)?a.value=f:a=f),label:m._lang.label.document,loading:e(d),type:e(_).inputs.file,required:!0},null,8,["modelValue","label","loading","type"])]),_:1}),l(N,null,{default:i(()=>[t("div",pe,[l(F,{class:"ms-auto",type:e(_).buttonType.primary,title:m._lang.common.import,onClick:v,size:e(_).buttonSize.medium,disabled:e(o)==null||e(a)==null||e(d)},null,8,["type","title","size","disabled"])])]),_:1})]),_:1},8,["title"]),t("div",ue,[(r(!0),g(k,null,E(e(I),(f,A)=>(r(),B(me,{key:A,item:f},null,8,["item"]))),128))])]),_:1})]),_:1},8,["title"])}}};export{ve as default};
