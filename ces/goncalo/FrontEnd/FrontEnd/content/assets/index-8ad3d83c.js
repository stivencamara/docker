import{b as B,d as W,u as c,r as m,o as $,a as X,c as _,e as f,_ as Z,f as ee,g as ae,h as te,i as ne,j as se,k as D,w as le,l as A,m as S,n as b,p as o,q as p,s as n,t as oe,v as P,x as u,y as h,F as O,z as re,A as z,B as ie,C as T,D as ue,E as de}from"./index-bb041a92.js";const N={search:s=>B.post("/es/search",s),getFilters:()=>B.get("/es/filters")},ce=W("SearchStore",{state:()=>({objectTypes:[],organizationParents:[],items:[],filterModel:c.createFilterModel(),pageCount:0,page:0}),getters:{},actions:{setObjectTypes(s){this.objectTypes=[];for(let v in s)this.objectTypes.some(g=>g.value===s[v].index)||this.objectTypes.push({value:s[v].index,label:s[v].title})},setOrganizationParents(s){this.organizationParents=[];for(let v in s)this.organizationParents.some(g=>g.value===s[v].organizationParent)||this.organizationParents.push({value:s[v].organizationParent,label:s[v].organizationParent})},setFilterModel(s){this.filterModel=s},setItems(s){this.items=s},setPageCount(s){this.pageCount=s},setPage(s){this.page=s}}}),pe={__name:"observer",props:{options:Object},emits:["intersect"],setup(s,{emit:v}){const g=s,r=m(null),y=m(null);return $(()=>{const I=g.options||{};r.value=new IntersectionObserver(([i])=>{i&&i.isIntersecting&&v("intersect")},I),r.value.observe(y.value)}),X(()=>{r.value.disconnect()}),(I,i)=>(_(),f("div",{class:"observer",ref_key:"observerRef",ref:y},null,512))}};const E=s=>(ue("data-v-e23a4940"),s=s(),de(),s),ve={class:"image-back-home px-5"},_e=E(()=>o("div",{class:"col-12 mt-5"},[o("h1",null,"Bem-vindo")],-1)),me={class:"col-12"},be={class:"col-12 search-btn"},ge=["disabled"],he=["disabled"],fe={class:"col-12"},ye=["innerHTML"],Ie={class:"mt-3"},Ce=["onClick"],Pe={class:"title"},ze={class:"description"},Ee={key:0,class:"f-14"},ke=E(()=>o("br",null,null,-1)),Ae=E(()=>o("br",null,null,-1)),Ve={key:0,class:"f-14"},Te=E(()=>o("br",null,null,-1)),Fe=E(()=>o("br",null,null,-1)),xe=E(()=>o("br",null,null,-1)),Se={class:"date"},Me=E(()=>o("hr",{class:"rounded"},null,-1)),Oe=["innerHTML"],we={__name:"search",setup(s){const v=ee(),g=ae(),r=ce();te();const y=ne();let I=m(!1),i=m(!1),F=m(!1),M=m(!1),a=m(c.createFilterModel()),k=m(0),x=m(999),C=m([]),w=m(0);se({types:[],organizations:[]});const j=D(()=>{let e="";return a.value.query&&(e+=`${a.value.query},`),a.value.abreviation&&(e+=` ${a.value.abreviation},`),a.value.index&&(e+=` ${a.value.index},`),a.value.name&&(e+=` ${a.value.name},`),a.value.organizationParents&&(e+=` ${a.value.organizationParents},`),e&&e[0]===" "&&(e=e.slice(1,e.length-1)),e&&e[e.length-1]===","&&(e=e.slice(0,e.length-1)),y.common.emptyResult.replace("{0}",`<strong>${e}</strong>`)}),H=D(()=>y.common.totalRecords.replace("{0}",`<strong>${w.value}</strong>`)),R=async()=>{if(F.value=!1,!a.value.query&&!a.value.abreviation&&!a.value.organizationParents&&!a.value.index&&!a.value.name){ie.warning(y.backoffice.home.requiredFilter);return}k.value=0,r.setFilterModel(a.value),C.value=[],await q(),F.value=!1},q=async()=>{M.value=!0,i.value=!0,a.value.pageNumber=k.value;let e=await N.search(a.value);e.code!==0&&await L(),c.validateResponse(e,null,()=>{C.value.push(...U(e.data.items)),k.value++,w.value=e.data.total,x.value=Math.ceil(e.data.total/a.value.pageSize),r.setItems(C.value),r.setPageCount(x.value),r.setPage(k.value),I.value=!0}),i.value=!1};$(async()=>{F.value=!1;let e=await N.getFilters();c.validateResponse(e,null,()=>{r.setObjectTypes(e.data.types.map(t=>(console.log(t),{title:y.label[t],index:t}))),r.setOrganizationParents(e.data.organizations.map(t=>({organizationParent:t})))}),v.hash==="#history"&&(i.value=!0,r.filterModel.query&&(C.value.push(...r.items),k.value=r.page,x.value=r.pageCount,a.value=r.filterModel,I.value=!0,F.value=!0,i.value=!1))});const L=async()=>{a.value.query=null,a.value.pageNumber=0,a.value.name=null,a.value.abreviation=null,a.value.organizationParents=null,a.value.index=null,I.value=!1};function K(e){let t="",d={};switch(e.index){case"organization":t=T.router.BACKOFFICE_SEARCH_DETAIL_ENTITY_PAGE.name,d={organizationId:c.encodeId(e.id),organizationVersion:c.encodeId(e.version)};break;case"pointofcare":t=T.router.BACKOFFICE_SEARCH_DETAIL_POINT_OF_CARE_PAGE.name,d={pointOfCareId:c.encodeId(e.id),pointOfCareVersion:c.encodeId(e.version)};break;case"service":t=T.router.BACKOFFICE_SEARCH_DETAIL_SERVICE_PAGE.name,d={serviceId:c.encodeId(e.id),serviceVersion:c.encodeId(e.version)};break;case"location":t=T.router.BACKOFFICE_SEARCH_DETAIL_LOCATION_PAGE.name,d={locationId:c.encodeId(e.id),locationVersion:c.encodeId(e.version)};break;case"document":t=T.router.BACKOFFICE_SEARCH_DETAIL_DOCUMENT_PAGE.name,d={documentId:c.encodeId(e.id),documentVersion:c.encodeId(e.version)};break}g.push({name:t,params:d})}function U(e){return e.map(t=>({id:t.id,version:t.version,title:t.pt.type,name:t.pt.name,organizationParent:t.organizationParent,address:t.address,date:c.formatDate(t.startDate),index:t.index,economicActivity:t.economicActivity,category:t.category,type:t.type}))}async function G(){k.value<x.value&&await q()}return le(()=>[a.value.query,a.value.abreviation,a.value.index,a.value.name,a.value.organizationParents],()=>{M.value=!1}),(e,t)=>{const d=A("row"),V=A("form-field"),Y=A("icon-search"),J=A("spinner"),Q=A("card");return _(),S(Q,{shadow:!0,class:"card-home",padding:!1},{body:b(()=>[o("div",ve,[p(d,null,{default:b(()=>[_e]),_:1}),p(d,{class:"mt-5 mb-3"},{default:b(()=>[o("div",me,[p(V,{id:"query",label:"Pesquisar",modelValue:n(a).query,"onUpdate:modelValue":t[0]||(t[0]=l=>n(a).query=l),placeholder:e._lang.backoffice.home.placeholderSearch,onKeyup:oe(R,["enter"]),type:n(P).inputs.search,disabled:n(i)},null,8,["modelValue","placeholder","onKeyup","type","disabled"])])]),_:1}),p(d,null,{default:b(()=>[p(V,{id:"abreviation",class:"mb-3 col-12 col-md-6",label:e._lang.label.abreviation,type:n(P).inputs.text,maxlength:45,modelValue:n(a).abreviation,"onUpdate:modelValue":t[1]||(t[1]=l=>n(a).abreviation=l),disabled:n(i)},null,8,["label","type","modelValue","disabled"]),p(V,{id:"types",class:"mb-3 col-12 col-md-6",modelValue:n(a).index,"onUpdate:modelValue":t[2]||(t[2]=l=>n(a).index=l),label:e._lang.label.type,disabled:n(i),type:n(P).inputs.multiselect,mode:n(P).multiselectMode.tags,options:n(r).objectTypes},null,8,["modelValue","label","disabled","type","mode","options"])]),_:1}),p(d,null,{default:b(()=>[p(V,{id:"name",class:"mb-3 col-12 col-md-6",label:e._lang.label.name,type:n(P).inputs.text,maxlength:45,modelValue:n(a).name,"onUpdate:modelValue":t[3]||(t[3]=l=>n(a).name=l),disabled:n(i)},null,8,["label","type","modelValue","disabled"]),p(V,{id:"organizationParents",class:"mb-3 col-12 col-md-6",modelValue:n(a).organizationParents,"onUpdate:modelValue":t[4]||(t[4]=l=>n(a).organizationParents=l),label:e._lang.label.parentOrganization,disabled:n(i),type:n(P).inputs.multiselect,mode:n(P).multiselectMode.tags,options:n(r).organizationParents},null,8,["modelValue","label","disabled","type","mode","options"])]),_:1}),p(d,{class:"mt-2 pb-3"},{default:b(()=>[o("div",be,[o("button",{class:"btn btn-secondary medium mb-3 me-3",type:"button",onClick:L,disabled:n(i)},u(e._lang.common.clear),9,ge),o("button",{class:"btn btn-primary medium mb-3",type:"button",onClick:R,disabled:n(i)},[p(Y,{color:"#FFF"}),h(" "+u(e._lang.common.search),1)],8,he)])]),_:1})]),n(I)?(_(),S(d,{key:0,class:"px-5"},{default:b(()=>[o("div",fe,[n(C).length?(_(),f(O,{key:0},[p(d,null,{default:b(()=>[o("div",{class:"mt-3",innerHTML:n(H)},null,8,ye)]),_:1}),o("div",Ie,[o("ul",null,[(_(!0),f(O,null,re(n(C),l=>(_(),f("li",{class:"infinite-scroll-item p-hand",onClick:qe=>K(l)},[o("h4",Pe,u(l.title),1),o("p",ze,[o("i",null,u(l.organizationParent),1),h(", "),o("strong",null,u(l.name),1)]),l.address?(_(),f("p",Ee,[h(u(l.address.zipCode)+" - "+u(l.address.island)+" ",1),ke,h(" "+u(l.address.county)+", "+u(l.address.parish)+", "+u(l.address.location)+" ",1),Ae,h(" "+u(l.address.address),1)])):z("",!0),l.index==="service"?(_(),f(O,{key:1},[l.category?(_(),f("p",Ve,[h(u(l.type)+" ",1),Te,h(" "+u(l.category)+" ",1),Fe,h(" "+u(l.economicActivity)+" ",1),xe])):z("",!0)],64)):z("",!0),o("p",Se,u(e._lang.label.startDate)+": "+u(l.date),1),Me],8,Ce))),256))]),p(pe,{onIntersect:G})])],64)):z("",!0),!n(C).length&&n(M)?(_(),f("div",{key:1,class:"mt-4 pb-4",innerHTML:n(j)},null,8,Oe)):z("",!0)])]),_:1})):z("",!0),p(d,null,{default:b(()=>[n(i)?(_(),S(J,{key:0,class:"mt-2 mb-2"})):z("",!0)]),_:1})]),_:1})}}},Re=Z(we,[["__scopeId","data-v-e23a4940"]]),Be={__name:"index",setup(s){return(v,g)=>{const r=A("page");return _(),S(r,{title:v._lang.backoffice.home.pageTitle},{default:b(()=>[p(Re)]),_:1},8,["title"])}}};export{Be as default};
