import{M as H,u as A,B as i,o as z,r as n,j as R,v as c,i as j,g as x,f as J,h as Q,k as F,O as W,w as S,l as m,c as p,m as f,n as g,q as d,s as e,K as v,A as X}from"./index-34a71b79.js";import{l as _}from"./location-c1e5575b.js";import{u as Y,_ as Z,a as $}from"./address-2d04222f.js";import{a as ee}from"./refusal-0c23d9f3.js";import{c as ae,r as te}from"./index.esm-e19cc10d.js";import{h as L}from"./helpers-d5b1a7ed.js";import{b as oe}from"./helpers-9519476b.js";/* empty css                                                                     */import{_ as le}from"./detail-actions-573056fa.js";import"./address-f463af69.js";import"./helpers-52b0bf51.js";import"./helpers-65a7776b.js";import"./helpers-6f2cc3d2.js";import"./helpers-0b4e847d.js";import"./helpers-03c0cf27.js";import"./settings-3cc5a699.js";const Ae={__name:"detail",setup(re){H(async()=>{u.value=A.decodeId(C.params.locationId),b.value=A.decodeId(C.params.locationVersion),!u.value||!b.value?P.push({name:i.router.BACKOFFICE_LOCATION_PAGE.name}):(await w(),await M(),k.value&&(await I.value.getHistory(),I.value.setActiveVersion(_.value),I.value.setStep()))}),z(()=>{l.value=!1});let u=n(0),b=n(0),l=n(!0);n([]);let a=R(L.newForm()),s=n(c.language.pt),V=R(L.formRules()),y=n(0),I=n(null);const T=Y(),B=j(),P=x(),C=J(),N=Q();ae.withMessage(B.common.requiredField,te);const h=F(()=>C.path.toLowerCase().indexOf("tarefas")>-1),E=F(()=>C.path.toLowerCase().indexOf("pesquisa")>-1),K=n(W.havePermission(c.permissions.organization.createEdit)),k=F(()=>!h.value&&K.value&&(a.recordStateTypeId==c.recordStateType.published||a.recordStateTypeId==c.recordStateType.extinct||a.recordStateTypeId==c.recordStateType.obsolete));async function M(){const t=await _.getById(u.value,b.value);A.validateResponse(t,null,()=>{Object.assign(a,t.data),N.emit(i.emitter.OBJECT_LOADED,t.data)})}async function w(){l.value=!0;const t=await _.getLists(s.value);A.validateResponse(t,null,()=>{T.setLists(t.data)}),l.value=!1}return S(()=>s.value,()=>{w()}),S(()=>[a.code,a.startDate,a.zipCode,a.islandId,a.countyId,a.parishId,a.locationTypeId,a.locationId,a.organizationId,a.address,a.locality],()=>{oe.calculatePercentage(a,L.progressFields(),t=>{T.setProgress(t),y.value=t})}),F(()=>y.value===100&&!l.value),(t,r)=>{const O=m("breadcrumb-item"),G=m("breadcrumb"),D=m("ctimeline"),U=m("card"),q=m("page");return p(),f(q,{title:t._lang.backoffice.location.detailPageTitle},{breadcrumb:g(()=>[d(G,{"has-home":!e(E)},{default:g(()=>[e(h)?(p(),f(O,{key:0,label:t._lang.backoffice.tasks.breadcrumbTitle,"router-path":e(i).router.BACKOFFICE_TASKS_PAGE.path},null,8,["label","router-path"])):e(E)?(p(),f(O,{key:1,label:t._lang.search.pageTitle,"router-path":e(i).router.HOME_PAGE.path},null,8,["label","router-path"])):(p(),f(O,{key:2,label:t._lang.backoffice.location.breadcrumbTitle,"router-path":e(i).router.BACKOFFICE_LOCATION_PAGE.path},null,8,["label","router-path"])),d(O,{label:t._lang.backoffice.location.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:g(()=>[d(le,{loading:e(l),"onUpdate:loading":r[0]||(r[0]=o=>v(l)?l.value=o:l=o),selectedLang:e(s),"onUpdate:selectedLang":r[1]||(r[1]=o=>v(s)?s.value=o:s=o),service:e(_),backRoute:e(i).router.BACKOFFICE_LOCATION_PAGE.name,editRoute:e(i).router.BACKOFFICE_EDIT_LOCATION_PAGE.name,itemIdField:"locationId",itemVersionField:"locationVersion",itemId:e(u),itemVersion:e(b),formModel:e(a),"show-record-state-actions":e(h),store:e(T)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:g(()=>[e(k)?(p(),f(D,{key:0,itemId:e(u),detailRoute:e(i).router.BACKOFFICE_DETAIL_LOCATION_PAGE.name,service:e(_),versionFieldName:"locationVersion",dateFieldName:"locationApprovedDate",detailRouteIdField:"locationId",detailRouteVersionField:"locationVersion",ref_key:"timeline",ref:I},null,8,["itemId","detailRoute","service"])):X("",!0),d(U,{shadow:!0},{body:g(()=>[d(Z,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":r[2]||(r[2]=o=>v(a)?a.value=o:a=o),loading:e(l),rules:e(V),selectedLang:e(s),vuelidate:{}},null,8,["modelValue","loading","rules","selectedLang"]),d($,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":r[3]||(r[3]=o=>v(a)?a.value=o:a=o),loading:e(l),rules:e(V),vuelidate:{}},null,8,["modelValue","loading","rules"]),d(ee,{validateForm:!1,disabled:!0,modelValue:e(a),"onUpdate:modelValue":r[4]||(r[4]=o=>v(a)?a.value=o:a=o),loading:e(l),selectedLang:e(s),vuelidate:{}},null,8,["modelValue","loading","selectedLang"])]),_:1})]),_:1},8,["title"])}}};export{Ae as default};
