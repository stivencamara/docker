import{g as ae,i as te,M as oe,X as ne,r as d,v as r,u as s,j as le,P as B,N as ie,o as re,k as se,l as c,c as g,e as de,q as n,n as m,m as f,s as e,V as ce,A as S,Y as me,L as C,O as ue,F as pe,C as h}from"./index-bb041a92.js";import{o as E}from"./organization-e761b3c4.js";import{i as ge}from"./import-8c86f9d0.js";import{u as be}from"./organization-7396450f.js";import{b as ye}from"./helpers-f0eb2667.js";import{o as fe}from"./helpers-87024433.js";import{_ as Se}from"./import-1b3ca9d8.js";import"./index.esm-70b2cee2.js";const he={__name:"index",setup(ve){const T=ae(),F=te(),L=be(),U=oe(),l=ne();d("import");let i=d(!1),v=d([]),I=d([]),z=d(r.tableSelectedState.none),b=d([]),O=d([]),V=d([]),A=d(s.createEmptyDataSource()),w=d([]);le({});const k=d(B.havePermission(r.permissions.organization.createEdit));d(B.havePermission(r.permissions.parameter.createEdit)),ie(async()=>{i.value=!0;const a=await E.getLists(U.getLanguage);s.validateResponse(a,null,()=>{L.setLists(a.data),b.value=[].concat(a.data.organizationRegionalPublicAdministrationTypeList).concat(a.data.organizationLocalAuthoritiesTypeList),b.value=s.removeDuplicateItemsOfArray(b.value),O.value=a.data.organizationList,s.sortArrayOffline("label asc",b.value),V.value=s.convertEnumToArray(F.enums.recordStateType),w.value=s.concatItemsBadge(V.value,ye.recordStateTypeBadgeOptions)}),i.value=!1}),re(async()=>{await _()});function N(a){T.push({name:h.router.BACKOFFICE_EDIT_ENTITY_PAGE.name,params:{organizationId:s.encodeId(a.organizationId),organizationVersion:s.encodeId(a.organizationVersion)}})}function R(a){T.push({name:h.router.BACKOFFICE_DETAIL_ENTITY_PAGE.name,params:{organizationId:s.encodeId(a.organizationId),organizationVersion:s.encodeId(a.organizationVersion)}})}async function D(){l.resetEntitySearchForm(),await P()}async function P(){l.entitySearchForm.pageNumber=1,await _()}async function M(){i.value=!0;const a=await E.create(fe.newForm());s.validateResponse(a,null,()=>{const o=s.encodeId(a.data.organizationId),y=s.encodeId(a.data.organizationVersion);T.push({name:h.router.BACKOFFICE_EDIT_ENTITY_PAGE.name,params:{organizationId:o,organizationVersion:y}})}),i.value=!1}async function G(a){l.entitySearchForm.sortBy=a,await _()}async function Y(a){l.entitySearchForm.pageNumber=a,await _()}async function _(){i.value=!0;let a=await E.search(l.entitySearchForm);s.validateResponse(a,null,()=>{A.value=a.data}),i.value=!1}async function K(a){i.value=!0;let o={data:a.value.data,name:a.value.name},y=await ge.organization(o);s.validateResponse(y,null,()=>{}),i.value=!1}const H=se(()=>k.value?F.backoffice.entities.pageTitle:F.backoffice.entities.breadcrumbTitle);return(a,o)=>{const y=c("breadcrumb-item"),j=c("breadcrumb"),q=c("cbutton"),u=c("form-field"),W=c("row"),X=c("cfilter"),p=c("ccolumn"),$=c("table-action-edit"),J=c("table-action-detail"),Q=c("ctable"),Z=c("card"),x=c("page");return g(),de(pe,null,[n(x,{title:e(H)},{breadcrumb:m(()=>[n(j,{"has-home":!0},{default:m(()=>[n(y,{label:a._lang.backoffice.entities.breadcrumbTitle},null,8,["label"])]),_:1})]),actions:m(()=>[k.value?(g(),f(q,{key:0,class:"col-12 col-sm-auto",type:e(r).buttonType.secondary,size:e(r).buttonSize.medium,title:a._lang.common.toAdd,icon:ce,onClick:M},null,8,["type","size","title"])):S("",!0)]),default:m(()=>[n(Z,{shadow:!0},{body:m(()=>[n(X,{title:a._lang.common.filter,disabled:e(i),"clear-click":D,"apply-click":P,loading:e(i),collapsed:!0},{default:m(()=>[n(W,null,{default:m(()=>[n(u,{id:"code",modelValue:e(l).entitySearchForm.code,"onUpdate:modelValue":o[0]||(o[0]=t=>e(l).entitySearchForm.code=t),class:"mb-3 col-12 col-md-6 col-lg-4",label:a._lang.label.code,type:e(r).inputs.text,maxlength:45,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),n(u,{class:"mb-3 col-12 col-md-6 col-lg-4",modelValue:e(l).entitySearchForm.organizationTypeIds,"onUpdate:modelValue":o[1]||(o[1]=t=>e(l).entitySearchForm.organizationTypeIds=t),label:a._lang.label.organizationTypeId,type:e(r).inputs.multiselect,options:e(b),disabled:e(i),mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"]),n(u,{class:"mb-3 col-12 col-md-6 col-lg-4",modelValue:e(l).entitySearchForm.parentOrganization,"onUpdate:modelValue":o[2]||(o[2]=t=>e(l).entitySearchForm.parentOrganization=t),label:a._lang.label.parentOrganization,type:e(r).inputs.multiselect,options:e(O),disabled:e(i),valueProp:e(r).multiselectValueProp.value3},null,8,["modelValue","label","type","options","disabled","valueProp"]),n(u,{class:"mb-3 col-12 col-lg-4",modelValue:e(l).entitySearchForm.abreviation,"onUpdate:modelValue":o[3]||(o[3]=t=>e(l).entitySearchForm.abreviation=t),label:a._lang.label.abreviation,type:e(r).inputs.text,maxlength:16,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),n(u,{class:"mb-3 col-12 col-md-8",modelValue:e(l).entitySearchForm.name,"onUpdate:modelValue":o[4]||(o[4]=t=>e(l).entitySearchForm.name=t),label:a._lang.label.name,type:e(r).inputs.text,maxlength:45,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),k.value?(g(),f(u,{key:0,class:"mb-3 col-12 col-lg-4",modelValue:e(l).entitySearchForm.recordStateTypeIds,"onUpdate:modelValue":o[5]||(o[5]=t=>e(l).entitySearchForm.recordStateTypeIds=t),label:a._lang.label.state,type:e(r).inputs.multiselect,options:e(V),disabled:e(i),mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"])):S("",!0),a._isGuestLogged?S("",!0):(g(),f(u,{key:1,id:"active",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(l).entitySearchForm.active,"onUpdate:modelValue":o[6]||(o[6]=t=>e(l).entitySearchForm.active=t),label:a._lang.label.public,type:e(r).inputs.checkbox,disabled:e(i)},null,8,["modelValue","label","type","disabled"]))]),_:1})]),_:1},8,["title","disabled","loading"]),n(me,null,{default:m(()=>[n(Q,{onSort:G,onChangePage:Y,selectedItems:e(v),"onUpdate:selectedItems":o[7]||(o[7]=t=>C(v)?v.value=t:v=t),unselectedItems:e(I),"onUpdate:unselectedItems":o[8]||(o[8]=t=>C(I)?I.value=t:I=t),selectedState:e(z),"onUpdate:selectedState":o[9]||(o[9]=t=>C(z)?z.value=t:z=t),data:e(A),checkbox:!1,loading:e(i),defaultSort:"OrganizationId",checkboxField:"organizationId"},{columns:m(()=>[n(p,{name:a._lang.label.code,field:"code",sortable:!0},null,8,["name"]),n(p,{name:a._lang.label.organizationTypeId,field:"organizationType",sortField:"organizationTypeId",sortable:!0},null,8,["name"]),n(p,{name:a._lang.label.abreviation,field:"abreviation",sortable:!0},null,8,["name"]),n(p,{name:a._lang.common.name,field:"name",sortable:!0},null,8,["name"]),n(p,{name:a._lang.label.parentOrganization,field:"organizationParent",sortField:"organizationParentId",sortable:!0},null,8,["name"]),n(p,{name:a._lang.common.state,field:"recordStateTypeId",align:e(r).columnAlign.center,custom:ue,options:e(w),sortable:!0},null,8,["name","align","options"])]),actions:m(t=>[t.item.recordStateTypeId==e(r).recordStateType.draft?(g(),f($,{key:0,onClick:ee=>N(t.item)},null,8,["onClick"])):S("",!0),t.item.recordStateTypeId>e(r).recordStateType.draft?(g(),f(J,{key:1,onClick:ee=>R(t.item)},null,8,["onClick"])):S("",!0)]),_:1},8,["selectedItems","unselectedItems","selectedState","data","loading"])]),_:1})]),_:1})]),_:1},8,["title"]),n(Se,{action:K})],64)}}};export{he as default};
