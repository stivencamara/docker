import{b as B,d as X,u as c,r as m,o as $,a as Z,c as _,e as y,_ as ee,f as ae,g as te,h as ne,i as se,j as le,k as D,w as oe,l as A,m as O,n as b,p as o,q as p,s as n,t as re,v as z,x as u,y as f,F as M,z as ie,A as P,B as ue,C as V,D as de,E as ce}from"./index-4697834f.js";const N={search:s=>B.post("/es/search",s),getFilters:()=>B.get("/es/filters")},pe=X("SearchStore",{state:()=>({objectTypes:[],organizationParents:[],items:[],filterModel:c.createFilterModel(),pageCount:0,page:0}),getters:{},actions:{setObjectTypes(s){this.objectTypes=[];for(let v in s)this.objectTypes.some(g=>g.value===s[v].index)||this.objectTypes.push({value:s[v].index,label:s[v].title})},setOrganizationParents(s){this.organizationParents=[];for(let v in s)this.organizationParents.some(g=>g.value===s[v].organizationParent)||this.organizationParents.push({value:s[v].organizationParent,label:s[v].organizationParent})},setFilterModel(s){this.filterModel=s},setItems(s){this.items=s},setPageCount(s){this.pageCount=s},setPage(s){this.page=s}}}),ve={__name:"observer",props:{options:Object},emits:["intersect"],setup(s,{emit:v}){const g=s,r=m(null),h=m(null);return $(()=>{const I=g.options||{};r.value=new IntersectionObserver(([i])=>{i&&i.isIntersecting&&v("intersect")},I),r.value.observe(h.value)}),Z(()=>{r.value.disconnect()}),(I,i)=>(_(),y("div",{class:"observer",ref_key:"observerRef",ref:h},null,512))}};const E=s=>(de("data-v-149a716a"),s=s(),ce(),s),_e={class:"image-back-home px-5"},me=E(()=>o("div",{class:"col-12 mt-5"},[o("h1",null,"Bem-vindo")],-1)),be={class:"col-12"},ge={class:"col-12 search-btn"},he=["disabled"],fe=["disabled"],ye={class:"col-12"},Ie=["innerHTML"],Ce={class:"mt-3"},ze=["onClick"],Pe={class:"title"},Ee={class:"description"},ke={key:0,class:"f-14"},Ae=E(()=>o("br",null,null,-1)),Te=E(()=>o("br",null,null,-1)),Ve={key:0,class:"f-14"},Fe=E(()=>o("br",null,null,-1)),xe=E(()=>o("br",null,null,-1)),Oe=E(()=>o("br",null,null,-1)),Se={class:"date"},Me=E(()=>o("hr",{class:"rounded"},null,-1)),we=["innerHTML"],Re={__name:"search",setup(s){const v=ae(),g=te(),r=pe();ne();const h=se();let I=m(!1),i=m(!1),F=m(!1),S=m(!1),a=m(c.createFilterModel()),k=m(0),x=m(999),C=m([]),w=m(0);le({types:[],organizations:[]});const j=D(()=>{let e="";return a.value.query&&(e+=`${a.value.query},`),a.value.abreviation&&(e+=` ${a.value.abreviation},`),a.value.index&&(e+=` ${a.value.index},`),a.value.name&&(e+=` ${a.value.name},`),a.value.organizationParents&&(e+=` ${a.value.organizationParents},`),e&&e[0]===" "&&(e=e.slice(1,e.length-1)),e&&e[e.length-1]===","&&(e=e.slice(0,e.length-1)),h.common.emptyResult.replace("{0}",`<strong>${e}</strong>`)}),H=e=>e==="Organização"?h.label.organization:e,K=D(()=>h.common.totalRecords.replace("{0}",`<strong>${w.value}</strong>`)),R=async()=>{if(F.value=!1,!a.value.query&&!a.value.abreviation&&!a.value.organizationParents&&!a.value.index&&!a.value.name){ue.warning(h.backoffice.home.requiredFilter);return}k.value=0,r.setFilterModel(a.value),C.value=[],await q(),F.value=!1},q=async()=>{S.value=!0,i.value=!0,a.value.pageNumber=k.value;let e=await N.search(a.value);e.code!==0&&await L(),c.validateResponse(e,null,()=>{C.value.push(...G(e.data.items)),k.value++,w.value=e.data.total,x.value=Math.ceil(e.data.total/a.value.pageSize),r.setItems(C.value),r.setPageCount(x.value),r.setPage(k.value),I.value=!0}),i.value=!1};$(async()=>{F.value=!1;let e=await N.getFilters();c.validateResponse(e,null,()=>{r.setObjectTypes(e.data.types.map(t=>({title:h.label[t],index:t}))),r.setOrganizationParents(e.data.organizations.map(t=>({organizationParent:t})))}),v.hash==="#history"&&(i.value=!0,r.filterModel.query&&(C.value.push(...r.items),k.value=r.page,x.value=r.pageCount,a.value=r.filterModel,I.value=!0,F.value=!0,i.value=!1))});const L=async()=>{a.value.query=null,a.value.pageNumber=0,a.value.name=null,a.value.abreviation=null,a.value.organizationParents=null,a.value.index=null,I.value=!1};function U(e){let t="",d={};switch(e.index){case"organization":t=V.router.BACKOFFICE_SEARCH_DETAIL_ENTITY_PAGE.name,d={organizationId:c.encodeId(e.id),organizationVersion:c.encodeId(e.version)};break;case"pointofcare":t=V.router.BACKOFFICE_SEARCH_DETAIL_POINT_OF_CARE_PAGE.name,d={pointOfCareId:c.encodeId(e.id),pointOfCareVersion:c.encodeId(e.version)};break;case"service":t=V.router.BACKOFFICE_SEARCH_DETAIL_SERVICE_PAGE.name,d={serviceId:c.encodeId(e.id),serviceVersion:c.encodeId(e.version)};break;case"location":t=V.router.BACKOFFICE_SEARCH_DETAIL_LOCATION_PAGE.name,d={locationId:c.encodeId(e.id),locationVersion:c.encodeId(e.version)};break;case"document":t=V.router.BACKOFFICE_SEARCH_DETAIL_DOCUMENT_PAGE.name,d={documentId:c.encodeId(e.id),documentVersion:c.encodeId(e.version)};break}g.push({name:t,params:d})}function G(e){return e.map(t=>({id:t.id,version:t.version,title:t.pt.type,name:t.pt.name,organizationParent:t.organizationParent,address:t.address,date:c.formatDate(t.startDate),index:t.index,economicActivity:t.economicActivity,category:t.category,type:t.type}))}async function Y(){k.value<x.value&&await q()}return oe(()=>[a.value.query,a.value.abreviation,a.value.index,a.value.name,a.value.organizationParents],()=>{S.value=!1}),(e,t)=>{const d=A("row"),T=A("form-field"),J=A("icon-search"),Q=A("spinner"),W=A("card");return _(),O(W,{shadow:!0,class:"card-home",padding:!1},{body:b(()=>[o("div",_e,[p(d,null,{default:b(()=>[me]),_:1}),p(d,{class:"mt-5 mb-3"},{default:b(()=>[o("div",be,[p(T,{id:"query",label:"Pesquisar",modelValue:n(a).query,"onUpdate:modelValue":t[0]||(t[0]=l=>n(a).query=l),placeholder:e._lang.backoffice.home.placeholderSearch,onKeyup:re(R,["enter"]),type:n(z).inputs.search,disabled:n(i)},null,8,["modelValue","placeholder","onKeyup","type","disabled"])])]),_:1}),p(d,null,{default:b(()=>[p(T,{id:"abreviation",class:"mb-3 col-12 col-md-6",label:e._lang.label.abreviation,type:n(z).inputs.text,maxlength:45,modelValue:n(a).abreviation,"onUpdate:modelValue":t[1]||(t[1]=l=>n(a).abreviation=l),disabled:n(i)},null,8,["label","type","modelValue","disabled"]),p(T,{id:"types",class:"mb-3 col-12 col-md-6",modelValue:n(a).index,"onUpdate:modelValue":t[2]||(t[2]=l=>n(a).index=l),label:e._lang.label.type,disabled:n(i),type:n(z).inputs.multiselect,mode:n(z).multiselectMode.tags,options:n(r).objectTypes},null,8,["modelValue","label","disabled","type","mode","options"])]),_:1}),p(d,null,{default:b(()=>[p(T,{id:"name",class:"mb-3 col-12 col-md-6",label:e._lang.label.name,type:n(z).inputs.text,maxlength:45,modelValue:n(a).name,"onUpdate:modelValue":t[3]||(t[3]=l=>n(a).name=l),disabled:n(i)},null,8,["label","type","modelValue","disabled"]),p(T,{id:"organizationParents",class:"mb-3 col-12 col-md-6",modelValue:n(a).organizationParents,"onUpdate:modelValue":t[4]||(t[4]=l=>n(a).organizationParents=l),label:e._lang.label.parentOrganization,disabled:n(i),type:n(z).inputs.multiselect,mode:n(z).multiselectMode.tags,options:n(r).organizationParents},null,8,["modelValue","label","disabled","type","mode","options"])]),_:1}),p(d,{class:"mt-2 pb-3"},{default:b(()=>[o("div",ge,[o("button",{class:"btn btn-secondary medium mb-3 me-3",type:"button",onClick:L,disabled:n(i)},u(e._lang.common.clear),9,he),o("button",{class:"btn btn-primary medium mb-3",type:"button",onClick:R,disabled:n(i)},[p(J,{color:"#FFF"}),f(" "+u(e._lang.common.search),1)],8,fe)])]),_:1})]),n(I)?(_(),O(d,{key:0,class:"px-5"},{default:b(()=>[o("div",ye,[n(C).length?(_(),y(M,{key:0},[p(d,null,{default:b(()=>[o("div",{class:"mt-3",innerHTML:n(K)},null,8,Ie)]),_:1}),o("div",Ce,[o("ul",null,[(_(!0),y(M,null,ie(n(C),l=>(_(),y("li",{class:"infinite-scroll-item p-hand",onClick:Le=>U(l)},[o("h4",Pe,u(H(l.title)),1),o("p",Ee,[o("i",null,u(l.organizationParent),1),f(", "),o("strong",null,u(l.name),1)]),l.address?(_(),y("p",ke,[f(u(l.address.zipCode)+" - "+u(l.address.island)+" ",1),Ae,f(" "+u(l.address.county)+", "+u(l.address.parish)+", "+u(l.address.location)+" ",1),Te,f(" "+u(l.address.address),1)])):P("",!0),l.index==="service"?(_(),y(M,{key:1},[l.category?(_(),y("p",Ve,[f(u(l.type)+" ",1),Fe,f(" "+u(l.category)+" ",1),xe,f(" "+u(l.economicActivity)+" ",1),Oe])):P("",!0)],64)):P("",!0),o("p",Se,u(e._lang.label.startDate)+": "+u(l.date),1),Me],8,ze))),256))]),p(ve,{onIntersect:Y})])],64)):P("",!0),!n(C).length&&n(S)?(_(),y("div",{key:1,class:"mt-4 pb-4",innerHTML:n(j)},null,8,we)):P("",!0)])]),_:1})):P("",!0),p(d,null,{default:b(()=>[n(i)?(_(),O(Q,{key:0,class:"mt-2 mb-2"})):P("",!0)]),_:1})]),_:1})}}},qe=ee(Re,[["__scopeId","data-v-149a716a"]]),De={__name:"index",setup(s){return(v,g)=>{const r=A("page");return _(),O(r,{title:v._lang.backoffice.home.pageTitle},{default:b(()=>[p(qe)]),_:1},8,["title"])}}};export{De as default};
