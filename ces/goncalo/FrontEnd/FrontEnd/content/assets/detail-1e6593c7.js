import{_ as U}from"./general-638b6d5b.js";import{g as K,f as H,i as j,h as z,r as l,G as L,s as C,j as h,N as q,K as x,u as v,z as n,M as J,k as m,c as b,l as E,w as c,n as p,p as e,I as F,y as Y}from"./index-a14ad215.js";import{d as f}from"./document-fd012777.js";import{d as R}from"./helpers-682b85b1.js";import{u as Q}from"./document-fa8d1f6f.js";import"./helpers-71142cd6.js";import{_ as W}from"./detail-actions-e07ee9c0.js";import"./index.esm-97dcd533.js";import"./refusal-4e803a93.js";import"./index.esm-88a1129f.js";import"./generic-90322b29.js";import"./helpers-bdeacb10.js";import"./helpers-d171baff.js";import"./helpers-11fd24aa.js";import"./helpers-a264fdb9.js";import"./helpers-bd233d9c.js";import"./settings-739a4c13.js";const _e={__name:"detail",setup(X){const k=K(),_=H();j();const y=z(),O=Q();let a=l(!0),r=L(R.newForm()),s=l(C.language.pt),B=L(R.formRules()),u=l(0),d=l(0),g=l(null);const T=h(()=>_.path.toLowerCase().indexOf("tarefas")>-1),w=h(()=>_.path.toLowerCase().indexOf("pesquisa")>-1);async function D(){a.value=!0;const t=await f.getById(u.value,d.value);v.validateResponse(t,null,()=>{Object.assign(r,t.data),y.emit(n.emitter.OBJECT_LOADED,t.data)}),a.value=!1}async function A(){a.value=!0;const t=await f.getLists(s.value,d.value);v.validateResponse(t,null,()=>{O.setLists(t.data)}),a.value=!1}q(()=>s.value,()=>{A()}),x(async()=>{u.value=v.decodeId(_.params.documentId),d.value=v.decodeId(_.params.documentVersion),!u.value||!d.value?k.push({name:n.router.BACKOFFICE_DOCUMENT_PAGE.name}):(await A(),await D(),V.value&&(await g.value.getHistory(),g.value.setActiveVersion(f.value),g.value.setStep()))});const M=l(J.havePermission(C.permissions.organization.createEdit)),V=h(()=>!T.value&&M.value&&r.recordStateTypeId!=C.recordStateType.draft);return(t,i)=>{const I=m("breadcrumb-item"),N=m("breadcrumb"),P=m("ctimeline"),G=m("card"),S=m("page");return b(),E(S,{title:t._lang.backoffice.document.detailPageTitle},{breadcrumb:c(()=>[p(N,{"has-home":!e(w)},{default:c(()=>[e(w)?(b(),E(I,{key:0,label:t._lang.search.pageTitle,"router-path":e(n).router.HOME_PAGE.path},null,8,["label","router-path"])):(b(),E(I,{key:1,label:t._lang.backoffice.document.breadcrumbTitle,"router-path":e(n).router.BACKOFFICE_DOCUMENT_PAGE.path},null,8,["label","router-path"])),p(I,{label:t._lang.backoffice.document.detailPageTitle},null,8,["label"])]),_:1},8,["has-home"])]),actions:c(()=>[p(W,{loading:e(a),"onUpdate:loading":i[0]||(i[0]=o=>F(a)?a.value=o:a=o),selectedLang:e(s),"onUpdate:selectedLang":i[1]||(i[1]=o=>F(s)?s.value=o:s=o),service:e(f),backRoute:e(n).router.BACKOFFICE_DOCUMENT_PAGE.name,editRoute:e(n).router.BACKOFFICE_EDIT_DOCUMENT_PAGE.name,itemIdField:"documentId",itemVersionField:"documentVersion",itemId:e(u),itemVersion:e(d),formModel:e(r),"show-record-state-actions":e(T),store:e(O)},null,8,["loading","selectedLang","service","backRoute","editRoute","itemId","itemVersion","formModel","show-record-state-actions","store"])]),default:c(()=>[e(V)?(b(),E(P,{key:0,itemId:e(u),detailRoute:e(n).router.BACKOFFICE_DETAIL_ENTITY_PAGE.name,service:e(f),versionFieldName:"documentVersion",dateFieldName:"documentApprovedDate",detailRouteIdField:"documentId",detailRouteVersionField:"documentVersion",ref_key:"timeline",ref:g},null,8,["itemId","detailRoute","service"])):Y("",!0),p(G,{shadow:!0},{body:c(()=>[p(U,{modelValue:e(r),"onUpdate:modelValue":i[2]||(i[2]=o=>F(r)?r.value=o:r=o),disabled:!0,loading:e(a),selectedLang:e(s),validateForm:!0,rules:e(B)},null,8,["modelValue","loading","selectedLang","rules"])]),_:1})]),_:1},8,["title"])}}};export{_e as default};
