import{b as ye}from"./refusal-64a629f9.js";import{i as U,h as W,r as I,l as u,c as _,m as R,n as T,y as se,x as H,q as i,s as o,v as s,_ as _e,N as ve,g as Ce,j as he,k as N,u as c,C as f,o as Se,a as ke,B as D,$ as Ie,e as q,L as Te,a2 as Oe,A as V,Q as ze,K as Me,F as oe,z as we,p as A,a3 as Fe,D as Le,E as De}from"./index-ecfd29ec.js";import{_ as $e}from"./cancel-confirm-b34d16c9.js";import{b as $}from"./helpers-42575dad.js";import{s as Ae}from"./settings-1fa7723b.js";/* empty css                                                                     */const Re={__name:"publish-confirm",props:{id:{String,required:!0,default:"confirm-publish"},action:{Function,required:!0}},setup(b){const v=b;U(),W();let e=I(!1);function O(){v.action()}return(r,B)=>{const C=u("cbutton"),z=u("modal");return _(),R(z,{id:v.id,title:r._lang.common.publish,size:o(s).modalSize.medium},{body:T(()=>[se(H(r._lang.backoffice.modals.confirmPublish),1)]),footer:T(()=>[i(C,{title:r._lang.common.no,type:o(s).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:o(e)},null,8,["title","type","disabled"]),i(C,{title:r._lang.common.yes,onClick:O,disabled:o(e),"data-bs-dismiss":"modal","aria-label":"Close"},null,8,["title","disabled"])]),_:1},8,["id","title","size"])}}},Be={__name:"submit-confirm",props:{id:{String,required:!0,default:"confirm-submit"},action:{Function,required:!0}},setup(b){const v=b;U(),W();let e=I(!1);function O(){v.action()}return(r,B)=>{const C=u("cbutton"),z=u("modal");return _(),R(z,{id:v.id,title:r._lang.common.submit,size:o(s).modalSize.medium},{body:T(()=>[se(H(r._lang.backoffice.modals.confirmSubmit),1)]),footer:T(()=>[i(C,{title:r._lang.common.no,type:o(s).buttonType.secondary,"data-bs-dismiss":"modal","aria-label":"Close",disabled:o(e)},null,8,["title","type","disabled"]),i(C,{title:r._lang.common.yes,onClick:O,disabled:o(e),"data-bs-dismiss":"modal","aria-label":"Close"},null,8,["title","disabled"])]),_:1},8,["id","title","size"])}}},Ee=b=>(Le("data-v-4d576a15"),b=b(),De(),b),je={key:0,class:"h-100",errors:""},Ne={class:"d-flex"},qe={class:"me-2 mt-2 p-hand"},Ve={class:"field w-100"},He={class:"mb-0"},Pe={class:"d-block mb-2 text-danger"},Ke=Ee(()=>A("hr",{class:"separator"},null,-1)),Ue={__name:"edit-actions",props:{loading:{Boolean,required:!0},canSubmit:{Boolean,required:!0},selectedLang:{type:[String,Number],required:!0},formModel:{type:Object,required:!0},service:{type:Object,required:!0},backRoute:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemVersion:{type:[String,Number],required:!0},vuelidate:{type:Object,default:null},store:{type:Object,required:!0},resource:{type:Object},directBackRoute:{Boolean,default:!1},organicOrigin:{Boolean,default:!1},itemIdField:{type:String,required:!0},progressFields:{type:Array},isHeritage:{Boolean,default:!1}},emits:["update:selectedLang","update:loading"],setup(b,{emit:v}){const e=b;ve(async()=>{await re()});const O=Ce(),r=U(),B="confirm-delete",C="confirm-cancel",z="confirm-publish",G="confirm-submit",ae=`#${B}_modal`,ie=`#${G}_modal`,h=W();let Q=I([]),J=I(!1),X=he({});const Y=N(()=>{var t,n;if((t=e.vuelidate)!=null&&t.$error){J.value=!0;const m=c.removeDuplicateItemsOfArray((n=e.vuelidate)==null?void 0:n.$errors),a=m.map(d=>({name:d.$property,group:d.$propertyPath,message:d.$message})),S=m.find(d=>d.$property==="texts");if(S){for(let d in S.$response.$data){let y=S.$response.$data[d];const p=Object.keys(y);for(let k in p){const j=p[k];y[j].$error&&a.push({name:j,group:`texts.${j}`,message:r.common.requiredField})}}c.removeItemOfArray(a,a.find(d=>d.name==="texts"))}const w=c.removeDuplicateItemsOfArray(a),F=$.getObjecTypeId(e.formModel);let E=[],g=e.progressFields;switch(F){case s.objectType.organization:g=e.progressFields;break;case s.objectType.service:g=e.progressFields;break;case s.objectType.document:g=e.progressFields;break;case s.objectType.location:g=e.progressFields;break;case s.objectType.pointOfCare:g=e.progressFields;break}for(let d in g){let y=g[d];if(y.includes(".")){const k=y.split(".");y=k[k.length-1]}const p=w.find(k=>k.name===y);p&&E.push(p)}return E}else return J.value&&h.emit(f.emitter.OFFCANVAS_CLOSE),[]});Se(()=>{Object.assign(X,e.formModel),h.on(f.emitter.DUPLICATE_NAMES,async t=>{t?await ne():K.value=null})}),ke(()=>{h.off(f.emitter.DUPLICATE_NAMES)});const L=N({get(){return e.selectedLang},set(t){v("update:selectedLang",t)}}),ne=async()=>{if((await e.service.changeState(e.itemId,e.itemVersion,s.recordStateType.published,K.value)).code===s.responseCode.success){const n=$.getObjecTypeId(e.formModel),m=$.getMessage(r,s.recordStateType.published,n);D.success(m),M()}},le=t=>{const n=document.getElementById(t.name);n?(h.emit(f.emitter.OFFCANVAS_CLOSE),n.focus()):console.error(`The element not founded with id: ${t.name}`)},l=N({get(){return e.loading},set(t){v("update:loading",t)}});async function re(){let t=await Ae.getLanguages();c.validateResponse(t,null,()=>{Q.value=t.data})}async function ce(){l.value=!0;const t=await e.service.delete(e.itemId,e.itemVersion);c.validateResponse(t,e.resource.deleted,()=>{e.store.setFormToCompare(e.formModel),M()}),l.value=!1}function de(){c.compareObjectIsDirty(e.store.formToCompare,e.formModel)?c.showModalById(C):M()}function ue(){c.showModalById(z)}function me(){M()}async function Z(){var t,n;l.value=!0,await((t=e.vuelidate)==null?void 0:t.$validate()),(n=e.vuelidate)!=null&&n.$error?te():D.success(r.common.formIsValid),l.value=!1}async function P(){l.value=!0;const t=await e.service.update(e.formModel);c.validateResponse(t,e.resource.saved,()=>{Object.assign(X,e.formModel),e.store.setFormToCompare(e.formModel)}),l.value=!1}async function pe(){var t,n;if(l.value=!0,await((t=e.vuelidate)==null?void 0:t.$validate()),(n=e.vuelidate)!=null&&n.$error)te();else{const m=await e.service.update(e.formModel);c.validateResponse(m,null,async()=>{e.store.setFormToCompare(e.formModel);const a=await e.service.submit(e.itemId,e.itemVersion);c.validateResponse(a,e.resource.submittedApproval,()=>{a.code===0&&M()},S=>{let w=S,F=r.errorCode[a.description];F&&(w=F),D.error(w)}),l.value=!1})}l.value=!1}let x=I(c.createEmptyDataSource()),K=I(null);async function fe(){var t,n;if(l.value=!0,await((t=e.vuelidate)==null?void 0:t.$validate()),(n=e.vuelidate)!=null&&n.$error)h.emit(f.emitter.ACCORDION_COLLAPSE_ALL),h.emit(f.emitter.SHOW_ERROR_CLICK),D.warning(r.common.requiredFields);else{const m=await e.service.update(e.formModel);c.validateResponse(m,null,async()=>{e.store.setFormToCompare(e.formModel);const a=await e.service.publish(e.itemId,e.itemVersion);a.code===s.responseCode.success?M():a.code===s.responseCode.organizationDuplicate||a.code===s.responseCode.locationDuplicate||a.code===s.responseCode.pointOfCareDuplicate||a.code===s.responseCode.documentDuplicate||a.code===s.responseCode.serviceDuplicate?(K.value=a.data.key,x.value=c.createEmptyDataSource(a.data.newListDuplicates),c.showModalById("duplicated-names")):c.showErrorToastByResponseCode(a.code),l.value=!1})}l.value=!1}let ee=I(!1);function be(t){ee.value=t.width<576}function te(){h.emit(f.emitter.ACCORDION_COLLAPSE_ALL),h.emit(f.emitter.SHOW_ERROR_CLICK),D.warning(r.common.requiredFields)}function M(){if(e.organicOrigin){O.push({name:f.router.BACKOFFICE_ORGANIC_PAGE.name});return}let t={name:e.backRoute};e.directBackRoute&&(t={path:e.backRoute}),O.push(t)}const ge=N({get(){return $.getFieldByLangAndName(e.formModel,L.value,"name")},set(t){$.setFieldByLangAndName(e.formModel,L.value,"name",t)}});return(t,n)=>{const m=u("Hotkeys"),a=u("cbutton"),S=u("lang-selector"),w=u("iconTrash"),F=u("cbutton-options-item"),E=u("cbutton-options"),g=u("confirm-delete-modal"),d=u("icon-focus"),y=Ie("resize");return _(),q(oe,null,[i(m,{shortcuts:["S"],debug:!0,onTriggered:P}),i(a,{class:"col-12 col-sm-auto",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,title:t._lang.common.cancel,onClick:de,disabled:o(l)},null,8,["type","size","title","disabled"]),i(S,{options:o(Q),selectedLang:o(L),"onUpdate:selectedLang":n[0]||(n[0]=p=>Te(L)?L.value=p:null),disabled:o(l)},null,8,["options","selectedLang","disabled"]),i(a,{class:"col-12 col-sm-auto",title:t._lang.common.save,type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:P,disabled:o(l)},null,8,["title","type","size","disabled"]),i(a,{class:"col-12 col-sm-auto d-sm-block d-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:Z,disabled:o(l),icon:Oe,"icon-color":"#002D74","data-bs-toggle":"tooltip","data-bs-title":t._lang.common.verify,"data-bs-placement":"top"},null,8,["type","size","disabled","data-bs-title"]),i(a,{class:"col-12 col-sm-auto d-sm-none",type:o(s).buttonType.secondary,size:o(s).buttonSize.large,onClick:Z,disabled:o(l),title:t._lang.common.verify},null,8,["type","size","disabled","title"]),e.formModel.recordStateTypeId!=o(s).recordStateType.approval&&!e.isHeritage?(_(),R(a,{key:0,class:"col-12 col-sm-auto",type:o(s).buttonType.primary,size:o(s).buttonSize.large,title:t._lang.common.submit,disabled:!e.canSubmit,"data-bs-target":ie,"data-bs-toggle":"modal"},null,8,["type","size","title","disabled"])):V("",!0),e.formModel.recordStateTypeId===o(s).recordStateType.approval||e.isHeritage?(_(),R(a,{key:1,size:o(s).buttonSize.large,title:t._lang.common.publish,disabled:!e.canSubmit,onClick:ue},null,8,["size","title","disabled"])):V("",!0),e.formModel.recordStateTypeId!=o(s).recordStateType.approval?ze((_(),R(E,{key:2,title:t._lang.common.actions,size:o(s).buttonSize.large,type:o(s).buttonType.secondary,disabled:o(l),class:Me({"dropdown-center":o(ee)})},{default:T(()=>[i(F,{title:t._lang.common.delete,"data-bs-target":ae,"data-bs-toggle":"modal"},{default:T(()=>[i(w,{color:"#002D74"})]),_:1},8,["title"])]),_:1},8,["title","size","type","disabled","class"])),[[y,be]]):V("",!0),i(g,{id:B,title:e.resource.delete,message:e.resource.deleteQuestion,action:ce},null,8,["title","message"]),i($e,{id:C,title:t._lang.common.cancel,action:me},null,8,["title"]),i(Re,{id:z,title:t._lang.common.publish,action:fe},null,8,["title"]),i(Be,{id:G,title:t._lang.common.submit,action:pe},null,8,["title"]),i(m,{shortcuts:["S"],debug:!0,onTriggered:P}),i(Fe,{title:t._lang.widgets.errors,type:o(s).offcanvas.danger,emitter:o(f).emitter.SHOW_ERROR_CLICK},{body:T(()=>[o(Y).length?(_(),q("div",je,[(_(!0),q(oe,null,we(o(Y),(p,k)=>(_(),q("div",Ne,[A("div",qe,[i(d,{color:"#002D74",class:"p-hand",onClick:j=>le(p)},null,8,["onClick"])]),A("div",Ve,[A("h6",He,H(t._lang.label[p.name]),1),A("span",Pe,H(p.message),1),Ke])]))),256))])):V("",!0)]),_:1},8,["title","type","emitter"]),i(ye,{"data-source":o(x),name:o(ge)},null,8,["data-source","name"])],64)}}},xe=_e(Ue,[["__scopeId","data-v-4d576a15"]]);export{xe as e};
