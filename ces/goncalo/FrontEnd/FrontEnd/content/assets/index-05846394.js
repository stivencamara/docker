import{g as te,i as oe,M as se,X as re,r as u,v as r,u as n,j as ie,P as ne,N as ce,o as de,k as R,l as c,c as g,m as y,n as d,q as s,s as e,V as me,A as C,Y as ue,L as U,O as pe,C as B}from"./index-873c41ed.js";import{s as E}from"./service-c291575d.js";import{u as ve}from"./service-41b6f92e.js";import{s as be}from"./helpers-c00a7420.js";import{b as ge}from"./helpers-e5cc3172.js";import"./helpers-0b554a9c.js";import"./index.esm-e9881f7b.js";const ke={__name:"index",setup(ye){const A=te(),S=oe(),f=ve(),z=se(),M="confirm-delete",t=re();let i=u(!1),F=u([]),V=u([]),_=u(r.tableSelectedState.none),k=u([]),O=u([]),w=u(n.createEmptyDataSource()),h=ie({});const L=u(ne.havePermission(r.permissions.service.createEdit));async function D(){if(h){i.value=!0;const a=await E.delete(h.serviceId);n.validateResponse(a,S.backoffice.service.deleted,()=>{n.removeItemOfArray(w.value.items,h)}),h=null,i.value=!1}}ce(async()=>{i.value=!0,k.value=n.convertEnumToArray(S.enums.recordStateType);const a=await E.getLists(z.getLanguage);n.validateResponse(a,null,()=>{f.setLists(a.data),k.value=n.convertEnumToArray(S.enums.recordStateType),O.value=n.concatItemsBadge(k.value,ge.recordStateTypeBadgeOptions)}),i.value=!1}),de(async()=>{await T()});function N(a){A.push({name:B.router.BACKOFFICE_EDIT_SERVICE_PAGE.name,params:{serviceId:n.encodeId(a.serviceId),serviceVersion:n.encodeId(a.serviceVersion)}})}function G(a){A.push({name:B.router.BACKOFFICE_DETAIL_SERVICE_PAGE.name,params:{serviceId:n.encodeId(a.serviceId),serviceVersion:n.encodeId(a.serviceVersion)}})}async function H(){t.resetServiceSearchForm(),await P()}async function P(){t.serviceSearchForm.pageNumber=1,await T()}async function K(){i.value=!0;const a=await E.create(be.newForm());n.validateResponse(a,null,()=>{const o=n.encodeId(a.data.serviceId),v=n.encodeId(a.data.serviceVersion);A.push({name:B.router.BACKOFFICE_EDIT_SERVICE_PAGE.name,params:{serviceId:o,serviceVersion:v}})}),i.value=!1}async function j(a){t.serviceSearchForm.sortBy=a,await T()}async function q(a){t.serviceSearchForm.pageNumber=a,await T()}async function T(){i.value=!0;let a=await E.search(t.serviceSearchForm);n.validateResponse(a,null,()=>{w.value=a.data}),i.value=!1}const Q=R(()=>L.value?S.backoffice.service.pageTitle:S.backoffice.service.breadcrumbTitle),W=R(()=>{var o,v;if(t.serviceSearchForm.serviceCategoryIds==null||((o=t.serviceSearchForm.serviceCategoryIds)==null?void 0:o.length)==0)return t.serviceSearchForm.serviceSubCategoryIds=[],[];var a=f.serviceSubCategoryList.filter(b=>t.serviceSearchForm.serviceCategoryIds.some(I=>I==b.state));return(v=t.serviceSearchForm.serviceSubCategoryIds)==null||v.forEach(b=>{a.some(I=>I.value==b)||n.removeItemOfArray(t.serviceSearchForm.serviceSubCategoryIds,b)}),a});return(a,o)=>{const v=c("breadcrumb-item"),b=c("breadcrumb"),I=c("cbutton"),m=c("form-field"),X=c("row"),Y=c("cfilter"),p=c("ccolumn"),J=c("table-action-edit"),Z=c("table-action-detail"),$=c("ctable"),x=c("card"),ee=c("confirm-delete-modal"),ae=c("page");return g(),y(ae,{title:e(Q)},{breadcrumb:d(()=>[s(b,{"has-home":!0},{default:d(()=>[s(v,{label:a._lang.backoffice.service.breadcrumbTitle},null,8,["label"])]),_:1})]),actions:d(()=>[L.value?(g(),y(I,{key:0,class:"col-12 col-sm-auto",type:e(r).buttonType.secondary,size:e(r).buttonSize.medium,title:a._lang.common.toAdd,icon:me,onClick:K},null,8,["type","size","title"])):C("",!0)]),default:d(()=>[s(x,{shadow:!0},{body:d(()=>[s(Y,{title:a._lang.common.filter,disabled:e(i),"clear-click":H,"apply-click":P,loading:e(i),collapsed:!0},{default:d(()=>[s(X,null,{default:d(()=>[s(m,{id:"code",modelValue:e(t).serviceSearchForm.code,"onUpdate:modelValue":o[0]||(o[0]=l=>e(t).serviceSearchForm.code=l),class:"mb-3 col-12 col-md-6 col-xl-4",label:a._lang.label.code,type:e(r).inputs.text,maxlength:45,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),s(m,{id:"serviceTypeId",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.serviceTypeIds,"onUpdate:modelValue":o[1]||(o[1]=l=>e(t).serviceSearchForm.serviceTypeIds=l),label:a._lang.label.serviceTypeId,type:e(r).inputs.multiselect,options:e(f).serviceTypeList,disabled:e(i),mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"]),s(m,{id:"organizationId",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.organization,"onUpdate:modelValue":o[2]||(o[2]=l=>e(t).serviceSearchForm.organization=l),label:a._lang.label.organizationHost,type:e(r).inputs.multiselect,options:e(f).organizationList,disabled:e(i),valueProp:e(r).multiselectValueProp.value3},null,8,["modelValue","label","type","options","disabled","valueProp"]),s(m,{id:"abreviation",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.abreviation,"onUpdate:modelValue":o[3]||(o[3]=l=>e(t).serviceSearchForm.abreviation=l),label:a._lang.label.abreviation,type:e(r).inputs.text,maxlength:16,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),s(m,{id:"name",class:"mb-3 col-12 col-md-8",modelValue:e(t).serviceSearchForm.name,"onUpdate:modelValue":o[4]||(o[4]=l=>e(t).serviceSearchForm.name=l),label:a._lang.label.name,type:e(r).inputs.text,maxlength:45,disabled:e(i)},null,8,["modelValue","label","type","disabled"]),s(m,{id:"serviceCategoryId",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.serviceCategoryIds,"onUpdate:modelValue":o[5]||(o[5]=l=>e(t).serviceSearchForm.serviceCategoryIds=l),label:a._lang.label.serviceCategoryId,type:e(r).inputs.multiselect,options:e(f).serviceCategoryList,disabled:e(i),mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"]),s(m,{id:"serviceSubCategoryId",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.serviceSubCategoryIds,"onUpdate:modelValue":o[6]||(o[6]=l=>e(t).serviceSearchForm.serviceSubCategoryIds=l),label:a._lang.label.serviceSubCategoryId,type:e(r).inputs.multiselect,options:e(W),disabled:e(i)||!e(t).serviceSearchForm.serviceCategoryIds.length,mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"]),L.value?(g(),y(m,{key:0,id:"recordStateId",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.recordStateIds,"onUpdate:modelValue":o[7]||(o[7]=l=>e(t).serviceSearchForm.recordStateIds=l),label:a._lang.label.state,type:e(r).inputs.multiselect,options:e(k),disabled:e(i),mode:e(r).multiselectMode.tags},null,8,["modelValue","label","type","options","disabled","mode"])):C("",!0),a._isGuestLogged?C("",!0):(g(),y(m,{key:1,id:"active",class:"mb-3 col-12 col-md-6 col-xl-4",modelValue:e(t).serviceSearchForm.active,"onUpdate:modelValue":o[8]||(o[8]=l=>e(t).serviceSearchForm.active=l),label:a._lang.label.public,type:e(r).inputs.checkbox,disabled:e(i)},null,8,["modelValue","label","type","disabled"]))]),_:1})]),_:1},8,["title","disabled","loading"]),s(ue,null,{default:d(()=>[s($,{onSort:j,onChangePage:q,selectedItems:e(F),"onUpdate:selectedItems":o[9]||(o[9]=l=>U(F)?F.value=l:F=l),unselectedItems:e(V),"onUpdate:unselectedItems":o[10]||(o[10]=l=>U(V)?V.value=l:V=l),selectedState:e(_),"onUpdate:selectedState":o[11]||(o[11]=l=>U(_)?_.value=l:_=l),data:e(w),checkbox:!1,loading:e(i),defaultSort:"code",checkboxField:"code"},{columns:d(()=>[s(p,{name:a._lang.label.code,field:"code",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.serviceTypeId,field:"serviceType",sortField:"serviceTypeId",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.serviceCategoryId,field:"serviceCategory",sortField:"serviceCategoryId",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.serviceSubCategoryId,field:"serviceSubCategory",sortField:"serviceSubCategoryId",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.abreviation,field:"abreviation",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.name,field:"name",sortable:!0},null,8,["name"]),s(p,{name:a._lang.label.state,field:"recordStateTypeId",align:e(r).columnAlign.center,custom:pe,options:e(O),sortable:!0},null,8,["name","align","options"])]),actions:d(l=>[l.item.recordStateTypeId==e(r).recordStateType.draft?(g(),y(J,{key:0,onClick:le=>N(l.item)},null,8,["onClick"])):C("",!0),l.item.recordStateTypeId>e(r).recordStateType.draft?(g(),y(Z,{key:1,onClick:le=>G(l.item)},null,8,["onClick"])):C("",!0)]),_:1},8,["selectedItems","unselectedItems","selectedState","data","loading"])]),_:1})]),_:1}),s(ee,{id:M,title:a._lang.backoffice.service.delete,message:a._lang.backoffice.service.deleteQuestion,action:D},null,8,["title","message"])]),_:1},8,["title"])}}};export{ke as default};
